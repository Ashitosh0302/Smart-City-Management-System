<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Metro Ticket Booking System</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #e65100 0%, #ff6f00 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
        }
        
        .header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
            padding: 20px;
        }
        
        .header h1 {
            font-size: 2.8rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }
        
        .header p {
            font-size: 1.1rem;
            opacity: 0.9;
        }
        
        .booking-card {
            background: white;
            border-radius: 15px;
            padding: 35px;
            box-shadow: 0 25px 50px rgba(0,0,0,0.2);
            margin-bottom: 40px;
            border: 1px solid rgba(255,255,255,0.1);
        }
        
        .form-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 25px;
            margin-bottom: 30px;
        }
        
        .form-group {
            margin-bottom: 0;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 10px;
            font-weight: 600;
            color: #333;
            font-size: 1rem;
        }
        
        .form-group select, 
        .form-group input {
            width: 100%;
            padding: 14px 18px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 1rem;
            transition: all 0.3s;
            background: white;
        }
        
        .form-group select:focus,
        .form-group input:focus {
            outline: none;
            border-color: #e65100;
            box-shadow: 0 0 0 3px rgba(230, 81, 0, 0.1);
        }
        
        .ticket-type-selector {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin: 25px 0;
        }
        
        .ticket-type {
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            padding: 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .ticket-type:hover {
            border-color: #e65100;
            transform: translateY(-2px);
        }
        
        .ticket-type.selected {
            border-color: #e65100;
            background: #fff3e0;
            box-shadow: 0 5px 15px rgba(230, 81, 0, 0.1);
        }
        
        .ticket-type .icon {
            font-size: 2rem;
            margin-bottom: 10px;
            color: #e65100;
        }
        
        .ticket-type .name {
            font-weight: 600;
            color: #333;
            margin-bottom: 5px;
        }
        
        .ticket-type .price {
            font-size: 0.9rem;
            color: #666;
        }
        
        .search-button {
            background: linear-gradient(135deg, #e65100 0%, #ff6f00 100%);
            color: white;
            border: none;
            padding: 18px 40px;
            border-radius: 10px;
            font-size: 1.2rem;
            font-weight: 600;
            cursor: pointer;
            width: 100%;
            transition: all 0.3s;
            letter-spacing: 0.5px;
        }
        
        .search-button:hover {
            transform: translateY(-3px);
            box-shadow: 0 15px 30px rgba(0,0,0,0.3);
        }
        
        .results-section {
            background: white;
            border-radius: 15px;
            padding: 35px;
            box-shadow: 0 25px 50px rgba(0,0,0,0.2);
            margin-bottom: 40px;
        }
        
        .results-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            padding-bottom: 20px;
            border-bottom: 3px solid #f0f0f0;
        }
        
        .results-title {
            font-size: 1.8rem;
            color: #e65100;
            font-weight: 700;
        }
        
        .results-count {
            background: #e65100;
            color: white;
            padding: 8px 20px;
            border-radius: 25px;
            font-size: 1rem;
            font-weight: 600;
        }
        
        .route-summary {
            background: linear-gradient(135deg, #fff3e0 0%, #ffecb3 100%);
            padding: 25px;
            border-radius: 12px;
            margin-bottom: 30px;
            border-left: 5px solid #e65100;
        }
        
        .route-details {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
        }
        
        .route-item {
            display: flex;
            flex-direction: column;
        }
        
        .route-label {
            font-size: 0.95rem;
            color: #666;
            margin-bottom: 5px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .route-value {
            font-size: 1.3rem;
            font-weight: 700;
            color: #e65100;
        }
        
        .metro-list {
            display: grid;
            gap: 25px;
        }
        
        .metro-card {
            border: 2px solid #e0e0e0;
            border-radius: 12px;
            padding: 25px;
            transition: all 0.3s;
            background: white;
            position: relative;
            overflow: hidden;
        }
        
        .metro-card:hover {
            border-color: #e65100;
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
            transform: translateY(-2px);
        }
        
        .metro-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 5px;
            height: 100%;
            background: linear-gradient(135deg, #e65100 0%, #ff6f00 100%);
        }
        
        .metro-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #f5f5f5;
        }
        
        .metro-line-info {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .line-color {
            width: 20px;
            height: 20px;
            border-radius: 50%;
        }
        
        .metro-number {
            background: #e65100;
            color: white;
            padding: 5px 12px;
            border-radius: 6px;
            font-weight: 600;
            font-size: 0.9rem;
        }
        
        .metro-title {
            font-size: 1.4rem;
            font-weight: 700;
            color: #e65100;
        }
        
        .metro-frequency {
            background: #ffecb3;
            color: #e65100;
            padding: 6px 15px;
            border-radius: 6px;
            font-size: 0.95rem;
            font-weight: 600;
        }
        
        .metro-timeline {
            display: flex;
            align-items: center;
            justify-content: space-between;
            background: #fff8e1;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
            position: relative;
        }
        
        .timeline-stops {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .stop-circle {
            width: 12px;
            height: 12px;
            background: #e65100;
            border-radius: 50%;
        }
        
        .stop-name {
            font-weight: 600;
            color: #333;
        }
        
        .metro-schedule {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        
        .schedule-item {
            background: #f5f5f5;
            padding: 15px;
            border-radius: 8px;
            text-align: center;
        }
        
        .schedule-time {
            font-size: 1.4rem;
            font-weight: 700;
            color: #e65100;
            margin-bottom: 5px;
        }
        
        .schedule-label {
            font-size: 0.9rem;
            color: #666;
        }
        
        .metro-details {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .detail-item {
            display: flex;
            flex-direction: column;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
        }
        
        .detail-label {
            font-size: 0.9rem;
            color: #666;
            margin-bottom: 8px;
            font-weight: 500;
        }
        
        .detail-value {
            font-size: 1.2rem;
            font-weight: 700;
            color: #333;
        }
        
        .metro-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding-top: 20px;
            border-top: 2px solid #f0f0f0;
        }
        
        .fare-info {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        
        .fare-amount {
            font-size: 2rem;
            font-weight: 700;
            color: #e65100;
        }
        
        .fare-type {
            font-size: 0.9rem;
            color: #666;
        }
        
        .metro-amenities {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
        }
        
        .amenity {
            display: flex;
            align-items: center;
            gap: 5px;
            background: #fff3e0;
            padding: 8px 12px;
            border-radius: 6px;
            font-size: 0.9rem;
            color: #e65100;
        }
        
        .book-button {
            background: linear-gradient(135deg, #388e3c 0%, #2e7d32 100%);
            color: white;
            border: none;
            padding: 12px 35px;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 1.1rem;
        }
        
        .book-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(56, 142, 60, 0.3);
        }
        
        .no-results {
            text-align: center;
            padding: 60px 40px;
            color: #666;
            font-size: 1.2rem;
            background: #f8f9fa;
            border-radius: 10px;
            border: 2px dashed #ddd;
        }
        
        .loading {
            text-align: center;
            padding: 60px;
            color: #e65100;
            font-size: 1.2rem;
        }
        
        .loading-spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #e65100;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .station-list {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 10px;
            margin: 20px 0;
            max-height: 300px;
            overflow-y: auto;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 8px;
        }
        
        .station-item {
            display: flex;
            align-items: center;
            padding: 12px 15px;
            background: white;
            border-radius: 8px;
            border-left: 4px solid #e65100;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .station-item:hover {
            transform: translateX(5px);
            background: #fff3e0;
        }
        
        .station-line-indicator {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            margin-right: 15px;
            flex-shrink: 0;
        }
        
        .station-details {
            flex: 1;
        }
        
        .station-name {
            font-weight: 600;
            color: #333;
            font-size: 1.1rem;
            margin-bottom: 2px;
        }
        
        .station-line-name {
            font-size: 0.85rem;
            color: #666;
        }
        
        .station-number {
            font-weight: 600;
            color: #e65100;
            margin-right: 10px;
        }
        
        .interchange-badge {
            background: #ff9800;
            color: white;
            padding: 2px 8px;
            border-radius: 4px;
            font-size: 0.8rem;
            margin-left: 10px;
        }
        
        .station-option {
            display: flex;
            align-items: center;
            padding: 12px 15px;
            gap: 10px;
        }
        
        .station-option .station-line-indicator {
            width: 15px;
            height: 15px;
            margin-right: 10px;
        }
        
        .station-option-text {
            display: flex;
            flex-direction: column;
        }
        
        .station-option-name {
            font-weight: 600;
            color: #333;
        }
        
        .station-option-line {
            font-size: 0.8rem;
            color: #666;
        }
        
        @media (max-width: 992px) {
            .form-row {
                grid-template-columns: 1fr;
            }
            
            .metro-details {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .metro-timeline {
                flex-direction: column;
                gap: 20px;
            }
        }
        
        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }
            
            .booking-card, .results-section {
                padding: 25px;
            }
            
            .metro-details {
                grid-template-columns: 1fr;
            }
            
            .metro-footer {
                flex-direction: column;
                gap: 20px;
                align-items: stretch;
            }
            
            .metro-amenities {
                justify-content: center;
            }
            
            .book-button {
                width: 100%;
            }
        }
        
        .metro-tag {
            position: absolute;
            top: 20px;
            right: 20px;
            background: #ff9800;
            color: white;
            padding: 5px 15px;
            border-radius: 4px;
            font-size: 0.9rem;
            font-weight: 600;
        }
        
        .next-metro {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            padding: 15px;
            background: linear-gradient(135deg, #e65100 0%, #ff6f00 100%);
            color: white;
            border-radius: 10px;
            margin-bottom: 20px;
            font-weight: 600;
        }
        
        /* Custom dropdown styling for station selection */
        .custom-select-wrapper {
            position: relative;
        }
        
        .custom-select {
            display: none;
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: white;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            max-height: 300px;
            overflow-y: auto;
            z-index: 1000;
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
        }
        
        .custom-select.show {
            display: block;
        }
        
        .custom-option {
            display: flex;
            align-items: center;
            padding: 12px 15px;
            cursor: pointer;
            transition: all 0.3s;
            border-bottom: 1px solid #f0f0f0;
        }
        
        .custom-option:last-child {
            border-bottom: none;
        }
        
        .custom-option:hover {
            background: #fff3e0;
        }
        
        .custom-option.selected {
            background: #fff3e0;
            font-weight: 600;
        }
        
        .option-circle {
            width: 16px;
            height: 16px;
            border-radius: 50%;
            margin-right: 12px;
            flex-shrink: 0;
        }
        
        .option-text {
            display: flex;
            flex-direction: column;
        }
        
        .option-name {
            font-weight: 600;
            color: #333;
            font-size: 1rem;
        }
        
        .option-line {
            font-size: 0.8rem;
            color: #666;
        }
        
        /* Style for the select dropdown that shows the colored circle */
        .styled-select {
            display: flex;
            align-items: center;
            padding: 14px 18px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            background: white;
            cursor: pointer;
            transition: all 0.3s;
            position: relative;
        }
        
        .styled-select:after {
            content: '‚ñº';
            position: absolute;
            right: 15px;
            top: 50%;
            transform: translateY(-50%);
            color: #666;
            font-size: 0.8rem;
        }
        
        .styled-select.open:after {
            transform: translateY(-50%) rotate(180deg);
        }
        
        .styled-select:hover {
            border-color: #e65100;
        }
        
        .selected-circle {
            width: 16px;
            height: 16px;
            border-radius: 50%;
            margin-right: 12px;
            flex-shrink: 0;
        }
        
        .selected-text {
            flex: 1;
            text-align: left;
            color: #333;
        }
        
        .selected-text.placeholder {
            color: #999;
        }
        
        .styled-select.open {
            border-color: #e65100;
            box-shadow: 0 0 0 3px rgba(230, 81, 0, 0.1);
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üöá Metro Rail Ticket Booking</h1>
            <p>Book your metro tickets with metros available every 20 minutes</p>
        </div>
        
        <div class="booking-card">
            <div class="form-row">
                <div class="form-group">
                    <label for="city">Select City</label>
                    <select id="city" onchange="updateStations()">
                        <option value="">-- Select City --</option>
                        <option value="delhi">Delhi Metro</option>
                        <option value="mumbai">Mumbai Metro</option>
                        <option value="chennai">Chennai Metro</option>
                        <option value="bangalore">Bangalore Metro (Namma Metro)</option>
                        <option value="kolkata">Kolkata Metro</option>
                        <option value="hyderabad">Hyderabad Metro</option>
                        <option value="pune">Pune Metro</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="date">Travel Date</label>
                    <input type="date" id="date" value="<?php echo date('Y-m-d'); ?>">
                </div>
            </div>
            
            <div class="form-row">
                <div class="form-group">
                    <label>From Station</label>
                    <div class="custom-select-wrapper">
                        <div class="styled-select" id="fromStationToggle" onclick="toggleCustomSelect('from')">
                            <div class="selected-circle" id="fromStationCircle" style="display: none;"></div>
                            <div class="selected-text placeholder" id="fromStationText">-- Select Station --</div>
                        </div>
                        <div class="custom-select" id="fromStationSelect">
                            <!-- Options will be added here -->
                        </div>
                    </div>
                    <input type="hidden" id="fromStation" value="">
                </div>
                
                <div class="form-group">
                    <label>To Station</label>
                    <div class="custom-select-wrapper">
                        <div class="styled-select" id="toStationToggle" onclick="toggleCustomSelect('to')">
                            <div class="selected-circle" id="toStationCircle" style="display: none;"></div>
                            <div class="selected-text placeholder" id="toStationText">-- Select Station --</div>
                        </div>
                        <div class="custom-select" id="toStationSelect">
                            <!-- Options will be added here -->
                        </div>
                    </div>
                    <input type="hidden" id="toStation" value="">
                </div>
                
                <div class="form-group">
                    <label for="passengers">Passengers</label>
                    <select id="passengers">
                        <option value="1">1 Passenger</option>
                        <option value="2">2 Passengers</option>
                        <option value="3">3 Passengers</option>
                        <option value="4">4 Passengers</option>
                        <option value="5">5 Passengers</option>
                    </select>
                </div>
            </div>
            
            <div class="ticket-type-selector">
                <div class="ticket-type" onclick="selectTicketType('single')">
                    <div class="icon">üé´</div>
                    <div class="name">Single Journey</div>
                    <div class="price">Standard Fare</div>
                </div>
                <div class="ticket-type" onclick="selectTicketType('return')">
                    <div class="icon">üîÅ</div>
                    <div class="name">Return Ticket</div>
                    <div class="price">Save 20%</div>
                </div>
                <div class="ticket-type" onclick="selectTicketType('daily')">
                    <div class="icon">üìÖ</div>
                    <div class="name">Daily Pass</div>
                    <div class="price">Unlimited Rides</div>
                </div>
                <div class="ticket-type" onclick="selectTicketType('weekly')">
                    <div class="icon">üóìÔ∏è</div>
                    <div class="name">Weekly Pass</div>
                    <div class="price">7 Days Travel</div>
                </div>
            </div>
            
            <div class="form-row">
                <div class="form-group">
                    <label for="journeyTime">Preferred Time</label>
                    <select id="journeyTime">
                        <option value="any">Any Time</option>
                        <option value="peak">Peak Hours (8-11 AM, 5-8 PM)</option>
                        <option value="offpeak">Off-Peak Hours</option>
                    </select>
                </div>
            </div>
            
            <button class="search-button" onclick="searchMetros()">
                üîç Search Metros
            </button>
        </div>
        
        <div class="results-section" id="resultsSection" style="display: none;">
            <div class="results-header">
                <div class="results-title">Available Metros</div>
                <div class="results-count" id="resultsCount">0 metros found</div>
            </div>
            
            <div class="route-summary">
                <div class="route-details">
                    <div class="route-item">
                        <span class="route-label">Route</span>
                        <span class="route-value" id="routeInfo"></span>
                    </div>
                    <div class="route-item">
                        <span class="route-label">Line</span>
                        <span class="route-value" id="lineInfo"></span>
                    </div>
                    <div class="route-item">
                        <span class="route-label">Date</span>
                        <span class="route-value" id="dateInfo"></span>
                    </div>
                    <div class="route-item">
                        <span class="route-label">Frequency</span>
                        <span class="route-value">Every 20 minutes</span>
                    </div>
                </div>
            </div>
            
            <div class="next-metro">
                ‚è∞ Next Metro in: <span id="nextMetroTimer">20:00</span> minutes
            </div>
            
            <div id="metroResults"></div>
            <div class="loading" id="loading" style="display: none;">
                <div class="loading-spinner"></div>
                Finding available metros...
            </div>
            <div class="no-results" id="noResults" style="display: none;">
                üö´ No metros found for this route. Please try different stations.
            </div>
        </div>
    </div>

    <script>
        // Metro lines data for different cities
        const metroSystems = {
            delhi: {
                name: "Delhi Metro",
                lines: [
                    { id: "red", name: "Red Line", color: "#ff0000" },
                    { id: "yellow", name: "Yellow Line", color: "#ffff00" },
                    { id: "blue", name: "Blue Line", color: "#0000ff" },
                    { id: "violet", name: "Violet Line", color: "#8a2be2" },
                    { id: "pink", name: "Pink Line", color: "#ff69b4" },
                    { id: "magenta", name: "Magenta Line", color: "#ff00ff" },
                    { id: "orange", name: "Orange Line", color: "#ffa500" },
                    { id: "green", name: "Green Line", color: "#008000" }
                ]
            },
            mumbai: {
                name: "Mumbai Metro",
                lines: [
                    { id: "line1", name: "Line 1 (Versova-Ghatkopar)", color: "#4169e1" },
                    { id: "line2a", name: "Line 2A (Dahisar-DN Nagar)", color: "#ff4500" },
                    { id: "line7", name: "Line 7 (Dahisar E-Andheri E)", color: "#800080" },
                    { id: "line3", name: "Line 3 (Colaba-Bandra-SEEPZ)", color: "#ffd700" }
                ]
            },
            chennai: {
                name: "Chennai Metro",
                lines: [
                    { id: "blue", name: "Blue Line", color: "#0000ff" },
                    { id: "green", name: "Green Line", color: "#008000" }
                ]
            },
            bangalore: {
                name: "Namma Metro",
                lines: [
                    { id: "purple", name: "Purple Line", color: "#800080" },
                    { id: "green", name: "Green Line", color: "#008000" },
                    { id: "yellow", name: "Yellow Line", color: "#ffff00" }
                ]
            },
            kolkata: {
                name: "Kolkata Metro",
                lines: [
                    { id: "blue", name: "North-South Line", color: "#0000ff" },
                    { id: "green", name: "East-West Line", color: "#008000" },
                    { id: "purple", name: "Purple Line", color: "#800080" }
                ]
            },
            hyderabad: {
                name: "Hyderabad Metro",
                lines: [
                    { id: "red", name: "Red Line", color: "#ff0000" },
                    { id: "blue", name: "Blue Line", color: "#0000ff" },
                    { id: "green", name: "Green Line", color: "#008000" }
                ]
            },
            pune: {
                name: "Pune Metro",
                lines: [
                    { id: "purple", name: "Purple Line", color: "#800080" },
                    { id: "aqua", name: "Aqua Line", color: "#00bfff" }
                ]
            }
        };

        // Station data for each city
        const stationData = {
            delhi: [
                { name: "Shaheed Sthal", line: "red", lineColor: "#ff0000", lineName: "Red Line" },
                { name: "Mohan Nagar", line: "red", lineColor: "#ff0000", lineName: "Red Line" },
                { name: "Kashmere Gate", line: "red", lineColor: "#ff0000", lineName: "Red Line" },
                { name: "Kashmere Gate", line: "yellow", lineColor: "#ffff00", lineName: "Yellow Line" },
                { name: "Rajiv Chowk", line: "yellow", lineColor: "#ffff00", lineName: "Yellow Line" },
                { name: "Rajiv Chowk", line: "blue", lineColor: "#0000ff", lineName: "Blue Line" },
                { name: "Dwarka Sector 21", line: "blue", lineColor: "#0000ff", lineName: "Blue Line" }
            ],
            mumbai: [
                { name: "Versova", line: "line1", lineColor: "#4169e1", lineName: "Line 1" },
                { name: "Andheri", line: "line1", lineColor: "#4169e1", lineName: "Line 1" },
                { name: "Ghatkopar", line: "line1", lineColor: "#4169e1", lineName: "Line 1" },
                { name: "Dahisar", line: "line2a", lineColor: "#ff4500", lineName: "Line 2A" }
            ],
            bangalore: [
                { name: "Baiyappanahalli", line: "purple", lineColor: "#800080", lineName: "Purple Line" },
                { name: "MG Road", line: "purple", lineColor: "#800080", lineName: "Purple Line" },
                { name: "Majestic", line: "purple", lineColor: "#800080", lineName: "Purple Line" },
                { name: "Majestic", line: "green", lineColor: "#008000", lineName: "Green Line" },
                { name: "Nagasandra", line: "green", lineColor: "#008000", lineName: "Green Line" }
            ],
            pune: [
                { name: "KASARWADI", line: "purple", lineColor: "#800080", lineName: "Purple Line" },
                { name: "PHUGEWADI", line: "purple", lineColor: "#800080", lineName: "Purple Line" },
                { name: "DAPODI", line: "purple", lineColor: "#800080", lineName: "Purple Line" },
                { name: "BOPODI", line: "purple", lineColor: "#800080", lineName: "Purple Line" },
                { name: "KHADKI", line: "purple", lineColor: "#800080", lineName: "Purple Line" },
                { name: "SHIVAJI NAGAR", line: "purple", lineColor: "#800080", lineName: "Purple Line" },
                { name: "DISTRICT COURT, PUNE", line: "purple", lineColor: "#800080", lineName: "Purple Line" },
                { name: "VANAZ", line: "aqua", lineColor: "#00bfff", lineName: "Aqua Line" },
                { name: "ANAND NAGAR", line: "aqua", lineColor: "#00bfff", lineName: "Aqua Line" },
                { name: "RUBY HALL CLINIC", line: "aqua", lineColor: "#00bfff", lineName: "Aqua Line" },
                { name: "RAMWADI", line: "aqua", lineColor: "#00bfff", lineName: "Aqua Line" }
            ],
            hyderabad: [
                { name: "Miyapur", line: "red", lineColor: "#ff0000", lineName: "Red Line" },
                { name: "Ameerpet", line: "red", lineColor: "#ff0000", lineName: "Red Line" },
                { name: "Ameerpet", line: "blue", lineColor: "#0000ff", lineName: "Blue Line" }
            ],
            chennai: [
                { name: "Airport", line: "blue", lineColor: "#0000ff", lineName: "Blue Line" },
                { name: "Central", line: "blue", lineColor: "#0000ff", lineName: "Blue Line" }
            ],
            kolkata: [
                { name: "Dum Dum", line: "blue", lineColor: "#0000ff", lineName: "North-South Line" },
                { name: "Esplanade", line: "blue", lineColor: "#0000ff", lineName: "North-South Line" }
            ]
        };

        // Ticket types
        const ticketTypes = {
            single: { name: "Single Journey", discount: 0, icon: "üé´" },
            return: { name: "Return Ticket", discount: 0.2, icon: "üîÅ" },
            daily: { name: "Daily Pass", discount: 0.4, icon: "üìÖ" },
            weekly: { name: "Weekly Pass", discount: 0.5, icon: "üóìÔ∏è" }
        };

        // Metro train types
        const metroTypes = [
            { name: "Standard Metro", speed: "80 km/h", coaches: 6 },
            { name: "Express Metro", speed: "100 km/h", coaches: 8 },
            { name: "AC Metro", speed: "90 km/h", coaches: 6 },
            { name: "Women's Special", speed: "80 km/h", coaches: 4 }
        ];

        let selectedTicketType = 'single';
        let nextMetroTimer;
        let currentOpenSelect = null;

        // Close dropdown when clicking outside
        document.addEventListener('click', function(event) {
            if (currentOpenSelect && !event.target.closest('.custom-select-wrapper')) {
                closeAllSelects();
            }
        });

        function closeAllSelects() {
            document.querySelectorAll('.custom-select').forEach(select => {
                select.classList.remove('show');
            });
            document.querySelectorAll('.styled-select').forEach(select => {
                select.classList.remove('open');
            });
            currentOpenSelect = null;
        }

        function toggleCustomSelect(type) {
            const select = document.getElementById(`${type}StationSelect`);
            const toggle = document.getElementById(`${type}StationToggle`);
            
            // Close other open selects
            if (currentOpenSelect && currentOpenSelect !== select) {
                closeAllSelects();
            }
            
            if (select.classList.contains('show')) {
                select.classList.remove('show');
                toggle.classList.remove('open');
                currentOpenSelect = null;
            } else {
                select.classList.add('show');
                toggle.classList.add('open');
                currentOpenSelect = select;
            }
        }

        function updateStations() {
            const city = document.getElementById('city').value;
            const fromSelect = document.getElementById('fromStationSelect');
            const toSelect = document.getElementById('toStationSelect');
            
            // Reset selections
            document.getElementById('fromStation').value = '';
            document.getElementById('toStation').value = '';
            document.getElementById('fromStationText').textContent = '-- Select Station --';
            document.getElementById('fromStationText').className = 'selected-text placeholder';
            document.getElementById('toStationText').textContent = '-- Select Station --';
            document.getElementById('toStationText').className = 'selected-text placeholder';
            document.getElementById('fromStationCircle').style.display = 'none';
            document.getElementById('toStationCircle').style.display = 'none';
            
            if (city && stationData[city]) {
                // Clear existing options
                fromSelect.innerHTML = '';
                toSelect.innerHTML = '';
                
                // Get unique stations for this city
                const cityStations = stationData[city];
                const uniqueStations = [...new Set(cityStations.map(s => s.name))];
                
                // Populate from station dropdown
                uniqueStations.forEach((stationName, index) => {
                    // Find first occurrence to get line info
                    const stationInfo = cityStations.find(s => s.name === stationName);
                    
                    const option = document.createElement('div');
                    option.className = 'custom-option';
                    option.innerHTML = `
                        <div class="option-circle" style="background: ${stationInfo.lineColor}"></div>
                        <div class="option-text">
                            <div class="option-name">${stationName}</div>
                            <div class="option-line">${stationInfo.lineName}</div>
                        </div>
                    `;
                    
                    option.onclick = function() {
                        selectStation('from', stationName, stationInfo.lineColor, stationInfo.lineName);
                        closeAllSelects();
                    };
                    
                    fromSelect.appendChild(option);
                });
                
                // Populate to station dropdown
                uniqueStations.forEach((stationName, index) => {
                    const stationInfo = cityStations.find(s => s.name === stationName);
                    
                    const option = document.createElement('div');
                    option.className = 'custom-option';
                    option.innerHTML = `
                        <div class="option-circle" style="background: ${stationInfo.lineColor}"></div>
                        <div class="option-text">
                            <div class="option-name">${stationName}</div>
                            <div class="option-line">${stationInfo.lineName}</div>
                        </div>
                    `;
                    
                    option.onclick = function() {
                        selectStation('to', stationName, stationInfo.lineColor, stationInfo.lineName);
                        closeAllSelects();
                    };
                    
                    toSelect.appendChild(option);
                });
            } else {
                fromSelect.innerHTML = '';
                toSelect.innerHTML = '';
            }
            
            // Close any open selects
            closeAllSelects();
        }

        function selectStation(type, stationName, lineColor, lineName) {
            const hiddenInput = document.getElementById(`${type}Station`);
            const toggleText = document.getElementById(`${type}StationText`);
            const toggleCircle = document.getElementById(`${type}StationCircle`);
            
            hiddenInput.value = stationName;
            toggleText.textContent = stationName;
            toggleText.className = 'selected-text';
            toggleCircle.style.backgroundColor = lineColor;
            toggleCircle.style.display = 'block';
            
            // Update selected option styling
            const select = document.getElementById(`${type}StationSelect`);
            select.querySelectorAll('.custom-option').forEach(option => {
                option.classList.remove('selected');
                if (option.querySelector('.option-name').textContent === stationName) {
                    option.classList.add('selected');
                }
            });
            
            // If selecting from station, update to station options to exclude selected station
            if (type === 'from') {
                updateToStationOptions(stationName);
            }
        }

        function updateToStationOptions(selectedFromStation) {
            const city = document.getElementById('city').value;
            const toSelect = document.getElementById('toStationSelect');
            
            if (!city || !selectedFromStation) return;
            
            toSelect.innerHTML = '';
            
            const cityStations = stationData[city];
            const uniqueStations = [...new Set(cityStations.map(s => s.name))];
            
            // Remove the selected from station from to station options
            const availableStations = uniqueStations.filter(station => station !== selectedFromStation);
            
            availableStations.forEach(stationName => {
                const stationInfo = cityStations.find(s => s.name === stationName);
                
                const option = document.createElement('div');
                option.className = 'custom-option';
                option.innerHTML = `
                    <div class="option-circle" style="background: ${stationInfo.lineColor}"></div>
                    <div class="option-text">
                        <div class="option-name">${stationName}</div>
                        <div class="option-line">${stationInfo.lineName}</div>
                    </div>
                `;
                
                option.onclick = function() {
                    selectStation('to', stationName, stationInfo.lineColor, stationInfo.lineName);
                    closeAllSelects();
                };
                
                toSelect.appendChild(option);
            });
        }

        function selectTicketType(type) {
            selectedTicketType = type;
            
            // Update UI
            document.querySelectorAll('.ticket-type').forEach(ticket => {
                ticket.classList.remove('selected');
            });
            
            event.currentTarget.classList.add('selected');
        }

        function startNextMetroTimer() {
            let minutes = 20;
            let seconds = 0;
            
            if (nextMetroTimer) {
                clearInterval(nextMetroTimer);
            }
            
            nextMetroTimer = setInterval(() => {
                seconds--;
                if (seconds < 0) {
                    minutes--;
                    seconds = 59;
                }
                
                if (minutes < 0) {
                    minutes = 20;
                    seconds = 0;
                }
                
                document.getElementById('nextMetroTimer').textContent = 
                    `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
            }, 1000);
        }

        function searchMetros() {
            const city = document.getElementById('city').value;
            const fromStation = document.getElementById('fromStation').value;
            const toStation = document.getElementById('toStation').value;
            const date = document.getElementById('date').value;
            const passengers = document.getElementById('passengers').value;
            const journeyTime = document.getElementById('journeyTime').value;
            
            // Validation
            if (!city || !fromStation || !toStation) {
                alert('Please select city and both stations');
                return;
            }
            
            if (fromStation === toStation) {
                alert('From and To stations cannot be the same');
                return;
            }
            
            // Show results section
            document.getElementById('resultsSection').style.display = 'block';
            document.getElementById('loading').style.display = 'block';
            document.getElementById('noResults').style.display = 'none';
            document.getElementById('metroResults').innerHTML = '';
            
            // Get line information for the stations
            const cityStations = stationData[city];
            const fromStationInfo = cityStations.find(s => s.name === fromStation);
            const toStationInfo = cityStations.find(s => s.name === toStation);
            
            // Update route info
            const cityName = metroSystems[city].name;
            document.getElementById('routeInfo').textContent = `${fromStation} ‚Üí ${toStation}`;
            document.getElementById('lineInfo').textContent = fromStationInfo ? fromStationInfo.lineName : "Multiple Lines";
            document.getElementById('dateInfo').textContent = new Date(date).toLocaleDateString('en-US', { 
                weekday: 'long', 
                year: 'numeric', 
                month: 'long', 
                day: 'numeric' 
            });
            
            // Start next metro timer
            startNextMetroTimer();
            
            // Simulate API call delay
            setTimeout(() => {
                generateMetroResults(city, fromStation, toStation, date, passengers, journeyTime);
            }, 1500);
        }

        function generateMetroResults(city, fromStation, toStation, date, passengers, journeyTime) {
            const metroResults = document.getElementById('metroResults');
            const loading = document.getElementById('loading');
            const noResults = document.getElementById('noResults');
            
            loading.style.display = 'none';
            metroResults.innerHTML = '';
            
            // Get station information for line colors
            const cityStations = stationData[city];
            const fromStationInfo = cityStations.find(s => s.name === fromStation);
            const toStationInfo = cityStations.find(s => s.name === toStation);
            
            // Generate exactly 20 metros as requested, every 20 minutes
            const numMetros = 20;
            const metros = [];
            
            // Generate departure times every 20 minutes from 05:00 to 23:40
            for (let i = 0; i < numMetros; i++) {
                const totalMinutes = 300 + (i * 20); // Start at 05:00 (300 minutes)
                const hour = Math.floor(totalMinutes / 60) % 24;
                const minute = totalMinutes % 60;
                const departureTime = `${hour.toString().padStart(2, '0')}:${minute.toString().padStart(2, '0')}`;
                
                metros.push(createMetro(i + 1, city, fromStation, toStation, fromStationInfo, toStationInfo, departureTime));
            }
            
            if (metros.length === 0) {
                noResults.style.display = 'block';
                document.getElementById('resultsCount').textContent = '0 metros found';
                return;
            }
            
            document.getElementById('resultsCount').textContent = `${metros.length} metros found`;
            
            // Display metros
            metros.forEach(metro => {
                const metroCard = createMetroCard(metro, passengers);
                metroResults.appendChild(metroCard);
            });
        }

        function createMetro(metroNumber, city, fromStation, toStation, fromStationInfo, toStationInfo, departureTime) {
            const metroType = metroTypes[Math.floor(Math.random() * metroTypes.length)];
            
            // Calculate travel time (simulated)
            const stationsList = stationData[city];
            const fromIndex = stationsList.findIndex(s => s.name === fromStation);
            const toIndex = stationsList.findIndex(s => s.name === toStation);
            const stationsBetween = Math.abs(toIndex - fromIndex);
            const travelTime = Math.max(5, stationsBetween * 2); // Minimum 5 minutes
            
            // Calculate arrival time
            const [depHour, depMinute] = departureTime.split(':').map(Number);
            let arrivalHour = depHour;
            let arrivalMinute = depMinute + travelTime;
            
            if (arrivalMinute >= 60) {
                arrivalHour += Math.floor(arrivalMinute / 60);
                arrivalMinute %= 60;
                arrivalHour %= 24;
            }
            
            const arrivalTime = `${arrivalHour.toString().padStart(2, '0')}:${arrivalMinute.toString().padStart(2, '0')}`;
            
            // Calculate fare based on distance
            const baseFare = 10 + (stationsBetween * 3); // ‚Çπ10 base + ‚Çπ3 per station equivalent
            const ticketFare = calculateTicketFare(baseFare, selectedTicketType, stationsBetween);
            
            return {
                number: `M${metroNumber.toString().padStart(3, '0')}`,
                name: `${metroType.name} #${metroNumber}`,
                type: metroType,
                departure: departureTime,
                arrival: arrivalTime,
                travelTime: travelTime,
                fromStation: fromStation,
                toStation: toStation,
                stationsBetween: stationsBetween,
                fromLineColor: fromStationInfo ? fromStationInfo.lineColor : "#800080",
                toLineColor: toStationInfo ? toStationInfo.lineColor : "#800080",
                fromLineName: fromStationInfo ? fromStationInfo.lineName : "Metro Line",
                toLineName: toStationInfo ? toStationInfo.lineName : "Metro Line",
                fare: ticketFare,
                amenities: ["AC", "WiFi", "Security Cameras", "LED Display", "Priority Seating", "CCTV"],
                frequency: "Every 20 minutes",
                nextMetro: calculateNextMetroTime(departureTime)
            };
        }

        function calculateTicketFare(baseFare, ticketType, stations) {
            const ticket = ticketTypes[ticketType];
            let fare = baseFare;
            
            switch(ticketType) {
                case 'return':
                    fare = baseFare * 2 * (1 - ticket.discount);
                    break;
                case 'daily':
                    fare = 100 * (1 - ticket.discount);
                    break;
                case 'weekly':
                    fare = 500 * (1 - ticket.discount);
                    break;
            }
            
            return Math.round(fare);
        }

        function calculateNextMetroTime(departureTime) {
            const [hour, minute] = departureTime.split(':').map(Number);
            let nextMinute = minute + 20;
            let nextHour = hour;
            
            if (nextMinute >= 60) {
                nextHour += Math.floor(nextMinute / 60);
                nextMinute %= 60;
                nextHour %= 24;
            }
            
            return `${nextHour.toString().padStart(2, '0')}:${nextMinute.toString().padStart(2, '0')}`;
        }

        function createMetroCard(metro, passengers) {
            const card = document.createElement('div');
            card.className = 'metro-card';
            
            // Mark some metros as express
            if (Math.random() > 0.7) {
                const tag = document.createElement('div');
                tag.className = 'metro-tag';
                tag.textContent = 'Express';
                card.appendChild(tag);
            }
            
            card.innerHTML = `
                <div class="metro-header">
                    <div class="metro-line-info">
                        <div class="line-color" style="background: ${metro.fromLineColor}"></div>
                        <div class="metro-number">${metro.number}</div>
                        <div class="metro-title">${metro.name}</div>
                    </div>
                    <div class="metro-frequency">${metro.frequency}</div>
                </div>
                
                <div class="metro-timeline">
                    <div class="timeline-stops">
                        <div class="stop-circle" style="background: ${metro.fromLineColor}"></div>
                        <div class="stop-name">${metro.fromStation}</div>
                        <div style="font-size: 0.85rem; color: #666; margin-left: 10px;">(${metro.fromLineName})</div>
                    </div>
                    <div style="color: #666;">‚Üí ${metro.stationsBetween} stops ‚Üí</div>
                    <div class="timeline-stops">
                        <div class="stop-circle" style="background: ${metro.toLineColor}"></div>
                        <div class="stop-name">${metro.toStation}</div>
                        <div style="font-size: 0.85rem; color: #666; margin-left: 10px;">(${metro.toLineName})</div>
                    </div>
                </div>
                
                <div class="metro-schedule">
                    <div class="schedule-item">
                        <div class="schedule-time">${metro.departure}</div>
                        <div class="schedule-label">Departure</div>
                    </div>
                    <div class="schedule-item">
                        <div class="schedule-time">${metro.arrival}</div>
                        <div class="schedule-label">Arrival</div>
                    </div>
                    <div class="schedule-item">
                        <div class="schedule-time">${metro.travelTime} min</div>
                        <div class="schedule-label">Travel Time</div>
                    </div>
                    <div class="schedule-item">
                        <div class="schedule-time">${metro.nextMetro}</div>
                        <div class="schedule-label">Next Metro</div>
                    </div>
                </div>
                
                <div class="metro-details">
                    <div class="detail-item">
                        <span class="detail-label">Line</span>
                        <span class="detail-value">${metro.fromLineName}</span>
                    </div>
                    <div class="detail-item">
                        <span class="detail-label">Speed</span>
                        <span class="detail-value">${metro.type.speed}</span>
                    </div>
                    <div class="detail-item">
                        <span class="detail-label">Coaches</span>
                        <span class="detail-value">${metro.type.coaches}</span>
                    </div>
                    <div class="detail-item">
                        <span class="detail-label">Stops</span>
                        <span class="detail-value">${metro.stationsBetween}</span>
                    </div>
                </div>
                
                <div class="metro-footer">
                    <div class="fare-info">
                        <div class="fare-amount">‚Çπ${metro.fare}</div>
                        <div class="fare-type">${ticketTypes[selectedTicketType].name}</div>
                    </div>
                    <div class="metro-amenities">
                        ${metro.amenities.map(amenity => `
                            <div class="amenity">‚úì ${amenity}</div>
                        `).join('')}
                    </div>
                    <button class="book-button" onclick="bookMetro('${metro.number}', ${metro.fare})">
                        Book Now
                    </button>
                </div>
            `;
            
            return card;
        }

        function bookMetro(metroNumber, fare) {
            const city = document.getElementById('city').value;
            const fromStation = document.getElementById('fromStation').value;
            const toStation = document.getElementById('toStation').value;
            const date = document.getElementById('date').value;
            const passengers = document.getElementById('passengers').value;
            const ticketType = ticketTypes[selectedTicketType].name;
            const totalFare = fare * parseInt(passengers);
            const cityName = metroSystems[city].name;
            
            alert(`üé´ Metro Ticket Confirmed!\n\n` +
                  `Metro: ${metroNumber}\n` +
                  `City: ${cityName}\n` +
                  `Route: ${fromStation} ‚Üí ${toStation}\n` +
                  `Date: ${new Date(date).toDateString()}\n` +
                  `Ticket Type: ${ticketType}\n` +
                  `Passengers: ${passengers}\n` +
                  `Total Fare: ‚Çπ${totalFare}\n\n` +
                  `Please collect your token at the station.`);
        }

        // Initialize date to today
        document.getElementById('date').valueAsDate = new Date();
        
        // Set default selected ticket type
        document.querySelector('.ticket-type').classList.add('selected');
    </script>
</body>
</html>