<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Metro Ticket Booking System</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #e65100 0%, #ff6f00 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
        }
        
        .header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
            padding: 20px;
        }
        
        .header h1 {
            font-size: 2.8rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }
        
        .header p {
            font-size: 1.1rem;
            opacity: 0.9;
        }
        
        .booking-card {
            background: white;
            border-radius: 15px;
            padding: 35px;
            box-shadow: 0 25px 50px rgba(0,0,0,0.2);
            margin-bottom: 40px;
            border: 1px solid rgba(255,255,255,0.1);
        }
        
        .form-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 25px;
            margin-bottom: 30px;
        }
        
        .form-group {
            margin-bottom: 0;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 10px;
            font-weight: 600;
            color: #333;
            font-size: 1rem;
        }
        
        .form-group select, 
        .form-group input {
            width: 100%;
            padding: 14px 18px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 1rem;
            transition: all 0.3s;
            background: white;
        }
        
        .form-group select:focus,
        .form-group input:focus {
            outline: none;
            border-color: #e65100;
            box-shadow: 0 0 0 3px rgba(230, 81, 0, 0.1);
        }
        
        .ticket-type-selector {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin: 25px 0;
        }
        
        .ticket-type {
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            padding: 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .ticket-type:hover {
            border-color: #e65100;
            transform: translateY(-2px);
        }
        
        .ticket-type.selected {
            border-color: #e65100;
            background: #fff3e0;
            box-shadow: 0 5px 15px rgba(230, 81, 0, 0.1);
        }
        
        .ticket-type .icon {
            font-size: 2rem;
            margin-bottom: 10px;
            color: #e65100;
        }
        
        .ticket-type .name {
            font-weight: 600;
            color: #333;
            margin-bottom: 5px;
        }
        
        .ticket-type .price {
            font-size: 0.9rem;
            color: #666;
        }
        
        .search-button {
            background: linear-gradient(135deg, #e65100 0%, #ff6f00 100%);
            color: white;
            border: none;
            padding: 18px 40px;
            border-radius: 10px;
            font-size: 1.2rem;
            font-weight: 600;
            cursor: pointer;
            width: 100%;
            transition: all 0.3s;
            letter-spacing: 0.5px;
        }
        
        .search-button:hover {
            transform: translateY(-3px);
            box-shadow: 0 15px 30px rgba(0,0,0,0.3);
        }
        
        .results-section {
            background: white;
            border-radius: 15px;
            padding: 35px;
            box-shadow: 0 25px 50px rgba(0,0,0,0.2);
            margin-bottom: 40px;
        }
        
        .results-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            padding-bottom: 20px;
            border-bottom: 3px solid #f0f0f0;
        }
        
        .results-title {
            font-size: 1.8rem;
            color: #e65100;
            font-weight: 700;
        }
        
        .results-count {
            background: #e65100;
            color: white;
            padding: 8px 20px;
            border-radius: 25px;
            font-size: 1rem;
            font-weight: 600;
        }
        
        .route-summary {
            background: linear-gradient(135deg, #fff3e0 0%, #ffecb3 100%);
            padding: 25px;
            border-radius: 12px;
            margin-bottom: 30px;
            border-left: 5px solid #e65100;
        }
        
        .route-details {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
        }
        
        .route-item {
            display: flex;
            flex-direction: column;
        }
        
        .route-label {
            font-size: 0.95rem;
            color: #666;
            margin-bottom: 5px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .route-value {
            font-size: 1.3rem;
            font-weight: 700;
            color: #e65100;
        }
        
        .metro-list {
            display: grid;
            gap: 25px;
        }
        
        .metro-card {
            border: 2px solid #e0e0e0;
            border-radius: 12px;
            padding: 25px;
            transition: all 0.3s;
            background: white;
            position: relative;
            overflow: hidden;
        }
        
        .metro-card:hover {
            border-color: #e65100;
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
            transform: translateY(-2px);
        }
        
        .metro-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 5px;
            height: 100%;
            background: linear-gradient(135deg, #e65100 0%, #ff6f00 100%);
        }
        
        .metro-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #f5f5f5;
        }
        
        .metro-line-info {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .line-color {
            width: 20px;
            height: 20px;
            border-radius: 50%;
        }
        
        .metro-number {
            background: #e65100;
            color: white;
            padding: 5px 12px;
            border-radius: 6px;
            font-weight: 600;
            font-size: 0.9rem;
        }
        
        .metro-title {
            font-size: 1.4rem;
            font-weight: 700;
            color: #e65100;
        }
        
        .metro-frequency {
            background: #ffecb3;
            color: #e65100;
            padding: 6px 15px;
            border-radius: 6px;
            font-size: 0.95rem;
            font-weight: 600;
        }
        
        .metro-timeline {
            display: flex;
            align-items: center;
            justify-content: space-between;
            background: #fff8e1;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
            position: relative;
        }
        
        .timeline-stops {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .stop-circle {
            width: 12px;
            height: 12px;
            background: #e65100;
            border-radius: 50%;
        }
        
        .stop-name {
            font-weight: 600;
            color: #333;
        }
        
        .metro-schedule {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        
        .schedule-item {
            background: #f5f5f5;
            padding: 15px;
            border-radius: 8px;
            text-align: center;
        }
        
        .schedule-time {
            font-size: 1.4rem;
            font-weight: 700;
            color: #e65100;
            margin-bottom: 5px;
        }
        
        .schedule-label {
            font-size: 0.9rem;
            color: #666;
        }
        
        .metro-details {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .detail-item {
            display: flex;
            flex-direction: column;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
        }
        
        .detail-label {
            font-size: 0.9rem;
            color: #666;
            margin-bottom: 8px;
            font-weight: 500;
        }
        
        .detail-value {
            font-size: 1.2rem;
            font-weight: 700;
            color: #333;
        }
        
        .metro-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding-top: 20px;
            border-top: 2px solid #f0f0f0;
        }
        
        .fare-info {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        
        .fare-amount {
            font-size: 2rem;
            font-weight: 700;
            color: #e65100;
        }
        
        .fare-type {
            font-size: 0.9rem;
            color: #666;
        }
        
        .metro-amenities {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
        }
        
        .amenity {
            display: flex;
            align-items: center;
            gap: 5px;
            background: #fff3e0;
            padding: 8px 12px;
            border-radius: 6px;
            font-size: 0.9rem;
            color: #e65100;
        }
        
        .book-button {
            background: linear-gradient(135deg, #388e3c 0%, #2e7d32 100%);
            color: white;
            border: none;
            padding: 12px 35px;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 1.1rem;
        }
        
        .book-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(56, 142, 60, 0.3);
        }
        
        .no-results {
            text-align: center;
            padding: 60px 40px;
            color: #666;
            font-size: 1.2rem;
            background: #f8f9fa;
            border-radius: 10px;
            border: 2px dashed #ddd;
        }
        
        .loading {
            text-align: center;
            padding: 60px;
            color: #e65100;
            font-size: 1.2rem;
        }
        
        .loading-spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #e65100;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .station-list {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 20px 0;
            max-height: 300px;
            overflow-y: auto;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 8px;
        }
        
        .station-item {
            padding: 10px 15px;
            background: white;
            border-radius: 6px;
            border-left: 4px solid #e65100;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .station-item:hover {
            transform: translateX(5px);
            background: #fff3e0;
        }
        
        .station-number {
            font-weight: 600;
            color: #e65100;
            margin-right: 10px;
        }
        
        .station-name {
            font-weight: 500;
            color: #333;
        }
        
        .interchange-badge {
            background: #ff9800;
            color: white;
            padding: 2px 8px;
            border-radius: 4px;
            font-size: 0.8rem;
            margin-left: 10px;
        }
        
        @media (max-width: 992px) {
            .form-row {
                grid-template-columns: 1fr;
            }
            
            .metro-details {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .metro-timeline {
                flex-direction: column;
                gap: 20px;
            }
        }
        
        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }
            
            .booking-card, .results-section {
                padding: 25px;
            }
            
            .metro-details {
                grid-template-columns: 1fr;
            }
            
            .metro-footer {
                flex-direction: column;
                gap: 20px;
                align-items: stretch;
            }
            
            .metro-amenities {
                justify-content: center;
            }
            
            .book-button {
                width: 100%;
            }
        }
        
        .metro-tag {
            position: absolute;
            top: 20px;
            right: 20px;
            background: #ff9800;
            color: white;
            padding: 5px 15px;
            border-radius: 4px;
            font-size: 0.9rem;
            font-weight: 600;
        }
        
        .next-metro {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            padding: 15px;
            background: linear-gradient(135deg, #e65100 0%, #ff6f00 100%);
            color: white;
            border-radius: 10px;
            margin-bottom: 20px;
            font-weight: 600;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üöá Metro Rail Ticket Booking</h1>
            <p>Book your metro tickets with metros available every 20 minutes</p>
        </div>
        
        <div class="booking-card">
            <div class="form-row">
                <div class="form-group">
                    <label for="city">Select City</label>
                    <select id="city" onchange="updateMetroLines()">
                        <option value="">-- Select City --</option>
                        <option value="delhi">Delhi Metro</option>
                        <option value="mumbai">Mumbai Metro</option>
                        <option value="chennai">Chennai Metro</option>
                        <option value="bangalore">Bangalore Metro (Namma Metro)</option>
                        <option value="kolkata">Kolkata Metro</option>
                        <option value="hyderabad">Hyderabad Metro</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="metroLine">Metro Line</label>
                    <select id="metroLine" onchange="updateStations()" disabled>
                        <option value="">-- Select Metro Line --</option>
                    </select>
                </div>
            </div>
            
            <div class="form-row">
                <div class="form-group">
                    <label for="fromStation">From Station</label>
                    <select id="fromStation" onchange="updateToStations()" disabled>
                        <option value="">-- Select Station --</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="toStation">To Station</label>
                    <select id="toStation" disabled>
                        <option value="">-- Select Station --</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="date">Travel Date</label>
                    <input type="date" id="date" value="<?php echo date('Y-m-d'); ?>">
                </div>
            </div>
            
            <div class="ticket-type-selector">
                <div class="ticket-type" onclick="selectTicketType('single')">
                    <div class="icon">üé´</div>
                    <div class="name">Single Journey</div>
                    <div class="price">Standard Fare</div>
                </div>
                <div class="ticket-type" onclick="selectTicketType('return')">
                    <div class="icon">üîÅ</div>
                    <div class="name">Return Ticket</div>
                    <div class="price">Save 20%</div>
                </div>
                <div class="ticket-type" onclick="selectTicketType('daily')">
                    <div class="icon">üìÖ</div>
                    <div class="name">Daily Pass</div>
                    <div class="price">Unlimited Rides</div>
                </div>
                <div class="ticket-type" onclick="selectTicketType('weekly')">
                    <div class="icon">üóìÔ∏è</div>
                    <div class="name">Weekly Pass</div>
                    <div class="price">7 Days Travel</div>
                </div>
            </div>
            
            <div class="form-row">
                <div class="form-group">
                    <label for="passengers">Passengers</label>
                    <select id="passengers">
                        <option value="1">1 Passenger</option>
                        <option value="2">2 Passengers</option>
                        <option value="3">3 Passengers</option>
                        <option value="4">4 Passengers</option>
                        <option value="5">5 Passengers</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="journeyTime">Preferred Time</label>
                    <select id="journeyTime">
                        <option value="any">Any Time</option>
                        <option value="peak">Peak Hours (8-11 AM, 5-8 PM)</option>
                        <option value="offpeak">Off-Peak Hours</option>
                    </select>
                </div>
            </div>
            
            <button class="search-button" onclick="searchMetros()">
                üîç Search Metros
            </button>
        </div>
        
        <div class="results-section" id="resultsSection" style="display: none;">
            <div class="results-header">
                <div class="results-title">Available Metros</div>
                <div class="results-count" id="resultsCount">0 metros found</div>
            </div>
            
            <div class="route-summary">
                <div class="route-details">
                    <div class="route-item">
                        <span class="route-label">Route</span>
                        <span class="route-value" id="routeInfo"></span>
                    </div>
                    <div class="route-item">
                        <span class="route-label">Line</span>
                        <span class="route-value" id="lineInfo"></span>
                    </div>
                    <div class="route-item">
                        <span class="route-label">Date</span>
                        <span class="route-value" id="dateInfo"></span>
                    </div>
                    <div class="route-item">
                        <span class="route-label">Frequency</span>
                        <span class="route-value">Every 20 minutes</span>
                    </div>
                </div>
            </div>
            
            <div class="next-metro">
                ‚è∞ Next Metro in: <span id="nextMetroTimer">20:00</span> minutes
            </div>
            
            <div id="metroResults"></div>
            <div class="loading" id="loading" style="display: none;">
                <div class="loading-spinner"></div>
                Finding available metros...
            </div>
            <div class="no-results" id="noResults" style="display: none;">
                üö´ No metros found for this route. Please try different stations.
            </div>
        </div>
    </div>

    <script>
        // Metro lines data for different cities
        const metroSystems = {
            delhi: {
                name: "Delhi Metro",
                lines: [
                    { id: "red", name: "Red Line", color: "#ff0000", stations: 29 },
                    { id: "yellow", name: "Yellow Line", color: "#ffff00", stations: 37 },
                    { id: "blue", name: "Blue Line", color: "#0000ff", stations: 50 },
                    { id: "violet", name: "Violet Line", color: "#8a2be2", stations: 34 },
                    { id: "pink", name: "Pink Line", color: "#ff69b4", stations: 38 },
                    { id: "magenta", name: "Magenta Line", color: "#ff00ff", stations: 25 },
                    { id: "orange", name: "Orange Line", color: "#ffa500", stations: 6 },
                    { id: "green", name: "Green Line", color: "#008000", stations: 21 }
                ]
            },
            mumbai: {
                name: "Mumbai Metro",
                lines: [
                    { id: "line1", name: "Line 1 (Versova-Ghatkopar)", color: "#4169e1", stations: 12 },
                    { id: "line2a", name: "Line 2A (Dahisar-DN Nagar)", color: "#ff4500", stations: 18 },
                    { id: "line7", name: "Line 7 (Dahisar E-Andheri E)", color: "#800080", stations: 13 },
                    { id: "line3", name: "Line 3 (Colaba-Bandra-SEEPZ)", color: "#ffd700", stations: 27 }
                ]
            },
            chennai: {
                name: "Chennai Metro",
                lines: [
                    { id: "blue", name: "Blue Line", color: "#0000ff", stations: 17 },
                    { id: "green", name: "Green Line", color: "#008000", stations: 16 }
                ]
            },
            bangalore: {
                name: "Namma Metro",
                lines: [
                    { id: "purple", name: "Purple Line", color: "#800080", stations: 18 },
                    { id: "green", name: "Green Line", color: "#008000", stations: 30 },
                    { id: "yellow", name: "Yellow Line", color: "#ffff00", stations: 16 }
                ]
            },
            kolkata: {
                name: "Kolkata Metro",
                lines: [
                    { id: "blue", name: "North-South Line", color: "#0000ff", stations: 26 },
                    { id: "green", name: "East-West Line", color: "#008000", stations: 12 },
                    { id: "purple", name: "Purple Line", color: "#800080", stations: 6 }
                ]
            },
            hyderabad: {
                name: "Hyderabad Metro",
                lines: [
                    { id: "red", name: "Red Line", color: "#ff0000", stations: 27 },
                    { id: "blue", name: "Blue Line", color: "#0000ff", stations: 23 },
                    { id: "green", name: "Green Line", color: "#008000", stations: 20 }
                ]
            }
        };

        // Station data for each metro line
        const stationData = {
            delhi: {
                red: [
                    "Shaheed Sthal", "Mohan Nagar", "Shyam Park", "Major Mohit Sharma",
                    "Raj Bagh", "Shaheed Nagar", "Dilshad Garden", "Jhil Mil",
                    "Mansarovar Park", "Shahdara", "Welcome", "Seelampur",
                    "Shastri Park", "Kashmere Gate", "Tis Hazari", "Pul Bangash",
                    "Pratap Nagar", "Shastri Nagar", "Inderlok", "Kanhiya Nagar",
                    "Keshav Puram", "Netaji Subhash Place", "Kohat Enclave",
                    "Pitampura", "Rohini East", "Rohini West", "Rithala"
                ],
                yellow: [
                    "Samaypur Badli", "Rohini Sector 18", "Haiderpur Badli Mor",
                    "Jahangirpuri", "Adarsh Nagar", "Azadpur", "Model Town",
                    "GTB Nagar", "Vishwa Vidyalaya", "Vidhan Sabha", "Civil Lines",
                    "Kashmere Gate", "Chandni Chowk", "Chawri Bazar", "New Delhi",
                    "Rajiv Chowk", "Patel Chowk", "Central Secretariat", "Udyog Bhawan",
                    "Lok Kalyan Marg", "Jor Bagh", "Dilli Haat INA", "AIIMS",
                    "Green Park", "Hauz Khas", "Malviya Nagar", "Saket",
                    "Qutab Minar", "Chhatarpur", "Sultanpur", "Ghitorni",
                    "Arjan Garh", "Guru Dronacharya", "Sikandarpur", "MG Road",
                    "IFFCO Chowk", "Huda City Centre"
                ],
                blue: [
                    "Dwarka Sector 21", "Dwarka Sector 8", "Dwarka Sector 9",
                    "Dwarka Sector 10", "Dwarka Sector 11", "Dwarka Sector 12",
                    "Dwarka Sector 13", "Dwarka Sector 14", "Dwarka",
                    "Dwarka Mor", "Nawada", "Uttam Nagar West",
                    "Uttam Nagar East", "Janakpuri West", "Janakpuri East",
                    "Tilak Nagar", "Subhash Nagar", "Tagore Garden",
                    "Rajouri Garden", "Ramesh Nagar", "Moti Nagar",
                    "Kirti Nagar", "Shadipur", "Patel Nagar",
                    "Rajendra Place", "Karol Bagh", "Jhandewalan",
                    "R K Ashram Marg", "Rajiv Chowk", "Barakhamba Road",
                    "Mandi House", "Supreme Court", "Indraprastha",
                    "Yamuna Bank", "Akshardham", "Mayur Vihar Phase-1",
                    "Mayur Vihar Extention", "New Ashok Nagar",
                    "Noida Sector 15", "Noida Sector 16",
                    "Noida Sector 18", "Botanical Garden",
                    "Golf Course", "Noida City Centre",
                    "Noida Sector 34", "Noida Sector 52",
                    "Noida Sector 61", "Noida Sector 59",
                    "Noida Sector 62", "Noida Electronic City"
                ]
            },
            mumbai: {
                line1: [
                    "Versova", "D N Nagar", "Azad Nagar", "Andheri",
                    "Western Express Highway", "Chakala", "Airport Road",
                    "Marol Naka", "Saki Naka", "Asalpha", "Jagruti Nagar",
                    "Ghatkopar"
                ],
                line2a: [
                    "Dahisar", "Anand Nagar", "Eksar", "Borivali West",
                    "Pahadi Eksar", "Kandarpada", "Mandapeshwar",
                    "Evershine Nagar", "Nancy Colony", "D.N. Nagar",
                    "Subhash Nagar", "Tagore Nagar", "Vazira Naka",
                    "Sanjay Gandhi National Park", "Mahatma Phule Chowk",
                    "Adarsha Nagar", "Ahilyabai Holkar Chowk", "Mominpada"
                ]
            },
            bangalore: {
                purple: [
                    "Baiyappanahalli", "Swami Vivekananda Road", "Indiranagar",
                    "Halasuru", "Trinity", "MG Road", "Cubbon Park",
                    "Vidhana Soudha", "Sir M. Visveshwaraya", "Majestic",
                    "City Railway Station", "Magadi Road", "Srirampura",
                    "Kengeri", "Rajajinagar", "Mahalakshmi", "Sandal Soap Factory",
                    "Yeshwanthpur"
                ],
                green: [
                    "Nagasandra", "Dasarahalli", "Jalahalli", "Peenya Industry",
                    "Peenya", "Goraguntepalya", "Yeshwanthpur", "Sandal Soap Factory",
                    "Mahalakshmi", "Rajajinagar", "Kuvempu Road", "Srirampura",
                    "Sampige Road", "Majestic", "Chikpete", "Krishna Rajendra Market",
                    "National College", "Lalbagh", "South End Circle",
                    "Jayanagar", "R.V. Road", "Banashankari", "J.P. Nagar",
                    "Yelachenahalli", "Konanakunte Cross", "Doddakallasandra",
                    "Vajarahalli", "Talaghattapura", "Silk Institute"
                ]
            }
        };

        // Ticket types
        const ticketTypes = {
            single: { name: "Single Journey", discount: 0, icon: "üé´" },
            return: { name: "Return Ticket", discount: 0.2, icon: "üîÅ" },
            daily: { name: "Daily Pass", discount: 0.4, icon: "üìÖ" },
            weekly: { name: "Weekly Pass", discount: 0.5, icon: "üóìÔ∏è" }
        };

        // Metro train types
        const metroTypes = [
            { name: "Standard Metro", speed: "80 km/h", coaches: 6 },
            { name: "Express Metro", speed: "100 km/h", coaches: 8 },
            { name: "AC Metro", speed: "90 km/h", coaches: 6 },
            { name: "Women's Special", speed: "80 km/h", coaches: 4 }
        ];

        let selectedTicketType = 'single';
        let nextMetroTimer;

        function updateMetroLines() {
            const city = document.getElementById('city').value;
            const lineSelect = document.getElementById('metroLine');
            
            if (city) {
                lineSelect.disabled = false;
                lineSelect.innerHTML = '<option value="">-- Select Metro Line --</option>';
                
                metroSystems[city].lines.forEach(line => {
                    const option = document.createElement('option');
                    option.value = line.id;
                    option.textContent = line.name;
                    option.style.color = line.color;
                    lineSelect.appendChild(option);
                });
            } else {
                lineSelect.disabled = true;
                lineSelect.innerHTML = '<option value="">-- Select Metro Line --</option>';
            }
        }

        function updateStations() {
            const city = document.getElementById('city').value;
            const line = document.getElementById('metroLine').value;
            const stationSelect = document.getElementById('fromStation');
            
            if (city && line && stationData[city] && stationData[city][line]) {
                stationSelect.disabled = false;
                stationSelect.innerHTML = '<option value="">-- Select Station --</option>';
                
                stationData[city][line].forEach((station, index) => {
                    const option = document.createElement('option');
                    option.value = station;
                    option.textContent = `${index + 1}. ${station}`;
                    stationSelect.appendChild(option);
                });
            } else {
                stationSelect.disabled = true;
                stationSelect.innerHTML = '<option value="">-- Select Station --</option>';
            }
        }

        function updateToStations() {
            const city = document.getElementById('city').value;
            const line = document.getElementById('metroLine').value;
            const fromStation = document.getElementById('fromStation').value;
            const toSelect = document.getElementById('toStation');
            
            if (city && line && fromStation && stationData[city] && stationData[city][line]) {
                toSelect.disabled = false;
                toSelect.innerHTML = '<option value="">-- Select Station --</option>';
                
                const stations = stationData[city][line];
                const fromIndex = stations.indexOf(fromStation);
                
                // Show only stations after the selected from station
                stations.forEach((station, index) => {
                    if (index > fromIndex) {
                        const option = document.createElement('option');
                        option.value = station;
                        option.textContent = `${index + 1}. ${station}`;
                        toSelect.appendChild(option);
                    }
                });
            } else {
                toSelect.disabled = true;
                toSelect.innerHTML = '<option value="">-- Select Station --</option>';
            }
        }

        function selectTicketType(type) {
            selectedTicketType = type;
            
            // Update UI
            document.querySelectorAll('.ticket-type').forEach(ticket => {
                ticket.classList.remove('selected');
            });
            
            event.currentTarget.classList.add('selected');
        }

        function startNextMetroTimer() {
            let minutes = 20;
            let seconds = 0;
            
            if (nextMetroTimer) {
                clearInterval(nextMetroTimer);
            }
            
            nextMetroTimer = setInterval(() => {
                seconds--;
                if (seconds < 0) {
                    minutes--;
                    seconds = 59;
                }
                
                if (minutes < 0) {
                    minutes = 20;
                    seconds = 0;
                }
                
                document.getElementById('nextMetroTimer').textContent = 
                    `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
            }, 1000);
        }

        function searchMetros() {
            const city = document.getElementById('city').value;
            const line = document.getElementById('metroLine').value;
            const fromStation = document.getElementById('fromStation').value;
            const toStation = document.getElementById('toStation').value;
            const date = document.getElementById('date').value;
            const passengers = document.getElementById('passengers').value;
            const journeyTime = document.getElementById('journeyTime').value;
            
            // Validation
            if (!city || !line || !fromStation || !toStation) {
                alert('Please select city, metro line, and both stations');
                return;
            }
            
            if (fromStation === toStation) {
                alert('From and To stations cannot be the same');
                return;
            }
            
            // Show results section
            document.getElementById('resultsSection').style.display = 'block';
            document.getElementById('loading').style.display = 'block';
            document.getElementById('noResults').style.display = 'none';
            document.getElementById('metroResults').innerHTML = '';
            
            // Update route info
            const cityName = metroSystems[city].name;
            const lineName = metroSystems[city].lines.find(l => l.id === line).name;
            document.getElementById('routeInfo').textContent = `${fromStation} ‚Üí ${toStation}`;
            document.getElementById('lineInfo').textContent = lineName;
            document.getElementById('dateInfo').textContent = new Date(date).toLocaleDateString('en-US', { 
                weekday: 'long', 
                year: 'numeric', 
                month: 'long', 
                day: 'numeric' 
            });
            
            // Start next metro timer
            startNextMetroTimer();
            
            // Simulate API call delay
            setTimeout(() => {
                generateMetroResults(city, line, fromStation, toStation, date, passengers, journeyTime);
            }, 1500);
        }

        function generateMetroResults(city, line, fromStation, toStation, date, passengers, journeyTime) {
            const metroResults = document.getElementById('metroResults');
            const loading = document.getElementById('loading');
            const noResults = document.getElementById('noResults');
            
            loading.style.display = 'none';
            metroResults.innerHTML = '';
            
            // Generate exactly 20 metros as requested, every 20 minutes
            const numMetros = 20;
            const metros = [];
            
            // Generate departure times every 20 minutes from 05:00 to 23:40
            for (let i = 0; i < numMetros; i++) {
                const totalMinutes = 300 + (i * 20); // Start at 05:00 (300 minutes)
                const hour = Math.floor(totalMinutes / 60) % 24;
                const minute = totalMinutes % 60;
                const departureTime = `${hour.toString().padStart(2, '0')}:${minute.toString().padStart(2, '0')}`;
                
                metros.push(createMetro(i + 1, city, line, fromStation, toStation, departureTime));
            }
            
            if (metros.length === 0) {
                noResults.style.display = 'block';
                document.getElementById('resultsCount').textContent = '0 metros found';
                return;
            }
            
            document.getElementById('resultsCount').textContent = `${metros.length} metros found`;
            
            // Display metros
            metros.forEach(metro => {
                const metroCard = createMetroCard(metro, passengers);
                metroResults.appendChild(metroCard);
            });
        }

        function createMetro(metroNumber, city, line, fromStation, toStation, departureTime) {
            const metroType = metroTypes[Math.floor(Math.random() * metroTypes.length)];
            const lineInfo = metroSystems[city].lines.find(l => l.id === line);
            
            // Calculate travel time based on distance (simulated)
            const stationsList = stationData[city][line];
            const fromIndex = stationsList.indexOf(fromStation);
            const toIndex = stationsList.indexOf(toStation);
            const stationsBetween = Math.abs(toIndex - fromIndex);
            const travelTime = stationsBetween * 3; // 3 minutes per station
            
            // Calculate arrival time
            const [depHour, depMinute] = departureTime.split(':').map(Number);
            let arrivalHour = depHour;
            let arrivalMinute = depMinute + travelTime;
            
            if (arrivalMinute >= 60) {
                arrivalHour += Math.floor(arrivalMinute / 60);
                arrivalMinute %= 60;
                arrivalHour %= 24;
            }
            
            const arrivalTime = `${arrivalHour.toString().padStart(2, '0')}:${arrivalMinute.toString().padStart(2, '0')}`;
            
            // Calculate fare based on distance
            const baseFare = 10 + (stationsBetween * 5); // ‚Çπ10 base + ‚Çπ5 per station
            const ticketFare = calculateTicketFare(baseFare, selectedTicketType, stationsBetween);
            
            return {
                number: `M${metroNumber.toString().padStart(3, '0')}`,
                name: `${metroType.name} #${metroNumber}`,
                type: metroType,
                departure: departureTime,
                arrival: arrivalTime,
                travelTime: travelTime,
                fromStation: fromStation,
                toStation: toStation,
                stationsBetween: stationsBetween,
                lineColor: lineInfo.color,
                lineName: lineInfo.name,
                fare: ticketFare,
                amenities: ["AC", "WiFi", "Security Cameras", "LED Display", "Priority Seating", "CCTV"],
                frequency: "Every 20 minutes",
                nextMetro: calculateNextMetroTime(departureTime)
            };
        }

        function calculateTicketFare(baseFare, ticketType, stations) {
            const ticket = ticketTypes[ticketType];
            let fare = baseFare;
            
            switch(ticketType) {
                case 'return':
                    fare = baseFare * 2 * (1 - ticket.discount);
                    break;
                case 'daily':
                    fare = 100 * (1 - ticket.discount);
                    break;
                case 'weekly':
                    fare = 500 * (1 - ticket.discount);
                    break;
            }
            
            return Math.round(fare);
        }

        function calculateNextMetroTime(departureTime) {
            const [hour, minute] = departureTime.split(':').map(Number);
            let nextMinute = minute + 20;
            let nextHour = hour;
            
            if (nextMinute >= 60) {
                nextHour += Math.floor(nextMinute / 60);
                nextMinute %= 60;
                nextHour %= 24;
            }
            
            return `${nextHour.toString().padStart(2, '0')}:${nextMinute.toString().padStart(2, '0')}`;
        }

        function createMetroCard(metro, passengers) {
            const card = document.createElement('div');
            card.className = 'metro-card';
            
            // Mark some metros as express
            if (Math.random() > 0.7) {
                const tag = document.createElement('div');
                tag.className = 'metro-tag';
                tag.textContent = 'Express';
                card.appendChild(tag);
            }
            
            card.innerHTML = `
                <div class="metro-header">
                    <div class="metro-line-info">
                        <div class="line-color" style="background: ${metro.lineColor}"></div>
                        <div class="metro-number">${metro.number}</div>
                        <div class="metro-title">${metro.name}</div>
                    </div>
                    <div class="metro-frequency">${metro.frequency}</div>
                </div>
                
                <div class="metro-timeline">
                    <div class="timeline-stops">
                        <div class="stop-circle"></div>
                        <div class="stop-name">${metro.fromStation}</div>
                    </div>
                    <div style="color: #666;">‚Üí ${metro.stationsBetween} stations ‚Üí</div>
                    <div class="timeline-stops">
                        <div class="stop-circle"></div>
                        <div class="stop-name">${metro.toStation}</div>
                    </div>
                </div>
                
                <div class="metro-schedule">
                    <div class="schedule-item">
                        <div class="schedule-time">${metro.departure}</div>
                        <div class="schedule-label">Departure</div>
                    </div>
                    <div class="schedule-item">
                        <div class="schedule-time">${metro.arrival}</div>
                        <div class="schedule-label">Arrival</div>
                    </div>
                    <div class="schedule-item">
                        <div class="schedule-time">${metro.travelTime} min</div>
                        <div class="schedule-label">Travel Time</div>
                    </div>
                    <div class="schedule-item">
                        <div class="schedule-time">${metro.nextMetro}</div>
                        <div class="schedule-label">Next Metro</div>
                    </div>
                </div>
                
                <div class="metro-details">
                    <div class="detail-item">
                        <span class="detail-label">Line</span>
                        <span class="detail-value">${metro.lineName}</span>
                    </div>
                    <div class="detail-item">
                        <span class="detail-label">Speed</span>
                        <span class="detail-value">${metro.type.speed}</span>
                    </div>
                    <div class="detail-item">
                        <span class="detail-label">Coaches</span>
                        <span class="detail-value">${metro.type.coaches}</span>
                    </div>
                    <div class="detail-item">
                        <span class="detail-label">Stops</span>
                        <span class="detail-value">${metro.stationsBetween}</span>
                    </div>
                </div>
                
                <div class="metro-footer">
                    <div class="fare-info">
                        <div class="fare-amount">‚Çπ${metro.fare}</div>
                        <div class="fare-type">${ticketTypes[selectedTicketType].name}</div>
                    </div>
                    <div class="metro-amenities">
                        ${metro.amenities.map(amenity => `
                            <div class="amenity">‚úì ${amenity}</div>
                        `).join('')}
                    </div>
                    <button class="book-button" onclick="bookMetro('${metro.number}', ${metro.fare})">
                        Book Now
                    </button>
                </div>
            `;
            
            return card;
        }

        function bookMetro(metroNumber, fare) {
            const fromStation = document.getElementById('fromStation').value;
            const toStation = document.getElementById('toStation').value;
            const date = document.getElementById('date').value;
            const passengers = document.getElementById('passengers').value;
            const ticketType = ticketTypes[selectedTicketType].name;
            const totalFare = fare * parseInt(passengers);
            
            alert(`üé´ Metro Ticket Confirmed!\n\n` +
                  `Metro: ${metroNumber}\n` +
                  `Route: ${fromStation} ‚Üí ${toStation}\n` +
                  `Date: ${new Date(date).toDateString()}\n` +
                  `Ticket Type: ${ticketType}\n` +
                  `Passengers: ${passengers}\n` +
                  `Total Fare: ‚Çπ${totalFare}\n\n` +
                  `Please collect your token at the station.`);
        }

        // Initialize date to today
        document.getElementById('date').valueAsDate = new Date();
        
        // Set default selected ticket type
        document.querySelector('.ticket-type').classList.add('selected');
    </script>
</body>
</html>