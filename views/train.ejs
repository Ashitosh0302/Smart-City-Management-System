<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>City Train Ticket Booking System</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #3d6ec7 0%, #33b7c9 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
        }
        
        .header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
            padding: 20px;
        }
        
        .header h1 {
            font-size: 2.8rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }
        
        .header p {
            font-size: 1.1rem;
            opacity: 0.9;
        }
        
        .booking-card {
            background: white;
            border-radius: 15px;
            padding: 35px;
            box-shadow: 0 25px 50px rgba(0,0,0,0.2);
            margin-bottom: 40px;
            border: 1px solid rgba(233, 139, 32, 0.1);
        }
        
        .form-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 25px;
            margin-bottom: 30px;
        }
        
        .form-group {
            margin-bottom: 0;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 10px;
            font-weight: 600;
            color: #333;
            font-size: 1rem;
        }
        
        .form-group select, 
        .form-group input {
            width: 100%;
            padding: 14px 18px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 1rem;
            transition: all 0.3s;
            background: white;
        }
        
        .form-group select:focus,
        .form-group input:focus {
            outline: none;
            border-color: #2ee0ba;
            box-shadow: 0 0 0 3px rgba(0, 105, 92, 0.1);
        }
        
        .search-button {
            background: linear-gradient(135deg, #0fa5ca 0%, #0ad7e6 100%);
            color: white;
            border: none;
            padding: 18px 40px;
            border-radius: 10px;
            font-size: 1.2rem;
            font-weight: 600;
            cursor: pointer;
            width: 100%;
            transition: all 0.3s;
            letter-spacing: 0.5px;
        }
        
        .search-button:hover {
            transform: translateY(-3px);
            box-shadow: 0 15px 30px rgba(0,0,0,0.3);
        }
        
        .results-section {
            background: white;
            border-radius: 15px;
            padding: 35px;
            box-shadow: 0 25px 50px rgba(0,0,0,0.2);
            margin-bottom: 40px;
        }
        
        .results-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            padding-bottom: 20px;
            border-bottom: 3px solid #f0f0f0;
        }
        
        .results-title {
            font-size: 1.8rem;
            color: #00695c;
            font-weight: 700;
        }
        
        .results-count {
            background: #00695c;
            color: white;
            padding: 8px 20px;
            border-radius: 25px;
            font-size: 1rem;
            font-weight: 600;
        }
        
        .route-summary {
            background: linear-gradient(135deg, #e0f2f1 0%, #c8e6c9 100%);
            padding: 25px;
            border-radius: 12px;
            margin-bottom: 30px;
            border-left: 5px solid #00695c;
        }
        
        .route-details {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
        }
        
        .route-item {
            display: flex;
            flex-direction: column;
        }
        
        .route-label {
            font-size: 0.95rem;
            color: #666;
            margin-bottom: 5px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .route-value {
            font-size: 1.3rem;
            font-weight: 700;
            color: #00695c;
        }
        
        .train-list {
            display: grid;
            gap: 25px;
        }
        
        .train-card {
            border: 2px solid #e0e0e0;
            border-radius: 12px;
            padding: 25px;
            transition: all 0.3s;
            background: white;
            position: relative;
            overflow: hidden;
        }
        
        .train-card:hover {
            border-color: #00695c;
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
            transform: translateY(-2px);
        }
        
        .train-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 5px;
            height: 100%;
            background: linear-gradient(135deg, #00695c 0%, #004d40 100%);
        }
        
        .train-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #f5f5f5;
        }
        
        .train-name {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .train-number {
            background: #00695c;
            color: white;
            padding: 5px 12px;
            border-radius: 6px;
            font-weight: 600;
            font-size: 0.9rem;
        }
        
        .train-title {
            font-size: 1.4rem;
            font-weight: 700;
            color: #00695c;
        }
        
        .train-type {
            background: #e0f2f1;
            color: #00695c;
            padding: 6px 15px;
            border-radius: 6px;
            font-size: 0.95rem;
            font-weight: 600;
        }
        
        .train-details {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .detail-item {
            display: flex;
            flex-direction: column;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
        }
        
        .detail-label {
            font-size: 0.9rem;
            color: #666;
            margin-bottom: 8px;
            font-weight: 500;
        }
        
        .detail-value {
            font-size: 1.2rem;
            font-weight: 700;
            color: #333;
        }
        
        .journey-timeline {
            display: flex;
            align-items: center;
            justify-content: space-between;
            background: linear-gradient(90deg, #e0f2f1, #c8e6c9);
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
            position: relative;
        }
        
        .timeline-station {
            text-align: center;
            z-index: 2;
        }
        
        .station-name {
            font-weight: 600;
            color: #00695c;
            margin-bottom: 5px;
        }
        
        .station-time {
            font-size: 1.1rem;
            font-weight: 700;
            color: #333;
        }
        
        .timeline-track {
            position: absolute;
            top: 50%;
            left: 10%;
            right: 10%;
            height: 3px;
            background: #00695c;
            z-index: 1;
        }
        
        .timeline-track::before {
            content: '';
            position: absolute;
            top: -4px;
            left: 0;
            width: 10px;
            height: 10px;
            background: #00695c;
            border-radius: 50%;
        }
        
        .timeline-track::after {
            content: '';
            position: absolute;
            top: -4px;
            right: 0;
            width: 10px;
            height: 10px;
            background: #00695c;
            border-radius: 50%;
        }
        
        .train-classes {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        
        .class-card {
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            padding: 15px;
            transition: all 0.3s;
            cursor: pointer;
        }
        
        .class-card:hover {
            border-color: #00695c;
            background: #e8f5e9;
        }
        
        .class-card.selected {
            border-color: #00695c;
            background: #c8e6c9;
            box-shadow: 0 5px 15px rgba(0, 105, 92, 0.1);
        }
        
        .class-name {
            font-weight: 600;
            color: #00695c;
            margin-bottom: 8px;
            font-size: 1.1rem;
        }
        
        .class-price {
            font-size: 1.3rem;
            font-weight: 700;
            color: #333;
            margin-bottom: 5px;
        }
        
        .class-availability {
            font-size: 0.9rem;
            color: #4caf50;
            font-weight: 500;
        }
        
        .train-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding-top: 20px;
            border-top: 2px solid #f0f0f0;
        }
        
        .train-amenities {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
        }
        
        .amenity {
            display: flex;
            align-items: center;
            gap: 5px;
            background: #e0f2f1;
            padding: 8px 12px;
            border-radius: 6px;
            font-size: 0.9rem;
            color: #00695c;
        }
        
        .book-button {
            background: linear-gradient(135deg, #4caf50 0%, #2e7d32 100%);
            color: white;
            border: none;
            padding: 12px 35px;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 1.1rem;
        }
        
        .book-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(76, 175, 80, 0.3);
        }
        
        .no-results {
            text-align: center;
            padding: 60px 40px;
            color: #666;
            font-size: 1.2rem;
            background: #f8f9fa;
            border-radius: 10px;
            border: 2px dashed #ddd;
        }
        
        .loading {
            text-align: center;
            padding: 60px;
            color: #00695c;
            font-size: 1.2rem;
        }
        
        .loading-spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #00695c;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        @media (max-width: 992px) {
            .form-row {
                grid-template-columns: 1fr;
            }
            
            .train-details {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .journey-timeline {
                flex-direction: column;
                gap: 20px;
            }
            
            .timeline-track {
                display: none;
            }
        }
        
        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }
            
            .booking-card, .results-section {
                padding: 25px;
            }
            
            .train-details {
                grid-template-columns: 1fr;
            }
            
            .train-footer {
                flex-direction: column;
                gap: 20px;
                align-items: stretch;
            }
            
            .train-amenities {
                justify-content: center;
            }
            
            .book-button {
                width: 100%;
            }
        }
        
        .success-badge {
            position: absolute;
            top: 20px;
            right: 20px;
            background: #4caf50;
            color: white;
            padding: 5px 15px;
            border-radius: 4px;
            font-size: 0.9rem;
            font-weight: 600;
            transform: rotate(15deg);
        }
        
        .city-info {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 15px;
            padding: 10px;
            background: #e0f2f1;
            border-radius: 8px;
        }
        
        .city-icon {
            font-size: 1.5rem;
        }
        
        .city-name {
            font-weight: 600;
            color: #00695c;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üöÜ City Train Ticket Booking</h1>
            <p>Book your city train tickets with trains available every 15-30 minutes</p>
        </div>
        
        <div class="booking-card">
            <div class="form-row">
                <div class="form-group">
                    <label for="city">Select City</label>
                    <select id="city" onchange="updateStations()">
                        <option value="">-- Select City --</option>
                        <option value="mumbai">Mumbai (Local Trains)</option>
                        <option value="pune">Pune (Metro & Local)</option>
                        <option value="delhi">Delhi (Metro)</option>
                        <option value="kolkata">Kolkata (Metro & Local)</option>
                        <option value="chennai">Chennai (Metro & Local)</option>
                        <option value="bangalore">Bangalore (Metro)</option>
                        <option value="hyderabad">Hyderabad (Metro)</option>
                        <option value="kochi">Kochi (Metro)</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="date">Journey Date</label>
                    <input type="date" id="date" value="<?php echo date('Y-m-d'); ?>">
                </div>
            </div>
            
            <div class="form-row">
                <div class="form-group">
                    <label for="fromStation">From Station</label>
                    <select id="fromStation" disabled>
                        <option value="">-- Select Station --</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="toStation">To Station</label>
                    <select id="toStation" disabled>
                        <option value="">-- Select Station --</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="class">Travel Class</label>
                    <select id="class">
                        <option value="all">All Classes</option>
                        <option value="first">First Class</option>
                        <option value="second">Second Class</option>
                        <option value="ac">AC Class</option>
                        <option value="ladies">Ladies Special</option>
                        <option value="handicap">Handicap Friendly</option>
                    </select>
                </div>
            </div>
            
            <div class="form-row">
                <div class="form-group">
                    <label for="passengers">Passengers</label>
                    <select id="passengers">
                        <option value="1">1 Passenger</option>
                        <option value="2">2 Passengers</option>
                        <option value="3">3 Passengers</option>
                        <option value="4">4 Passengers</option>
                        <option value="5">5 Passengers</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="time">Preferred Time</label>
                    <select id="time">
                        <option value="any">Any Time</option>
                        <option value="morning">Morning (6 AM - 12 PM)</option>
                        <option value="afternoon">Afternoon (12 PM - 4 PM)</option>
                        <option value="evening">Evening (4 PM - 8 PM)</option>
                        <option value="night">Night (8 PM - 11 PM)</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="ticketType">Ticket Type</label>
                    <select id="ticketType">
                        <option value="single">Single Journey</option>
                        <option value="return">Return Ticket</option>
                        <option value="daily">Daily Pass</option>
                        <option value="weekly">Weekly Pass</option>
                        <option value="monthly">Monthly Pass</option>
                    </select>
                </div>
            </div>
            
            <button class="search-button" onclick="searchTrains()">
                üîç Search Trains
            </button>
        </div>
        
        <div class="results-section" id="resultsSection" style="display: none;">
            <div class="results-header">
                <div class="results-title">Available Trains</div>
                <div class="results-count" id="resultsCount">0 trains found</div>
            </div>
            
            <div class="route-summary">
                <div class="city-info">
                    <div class="city-icon" id="cityIcon">üöá</div>
                    <div class="city-name" id="cityName"></div>
                </div>
                <div class="route-details">
                    <div class="route-item">
                        <span class="route-label">Route</span>
                        <span class="route-value" id="routeInfo"></span>
                    </div>
                    <div class="route-item">
                        <span class="route-label">Date</span>
                        <span class="route-value" id="dateInfo"></span>
                    </div>
                    <div class="route-item">
                        <span class="route-label">Trains Available</span>
                        <span class="route-value" id="timeInfo">Every 15-30 minutes</span>
                    </div>
                    <div class="route-item">
                        <span class="route-label">Ticket Type</span>
                        <span class="route-value" id="ticketTypeInfo"></span>
                    </div>
                </div>
            </div>
            
            <div id="trainResults"></div>
            <div class="loading" id="loading" style="display: none;">
                <div class="loading-spinner"></div>
                Searching for available trains...
            </div>
            <div class="no-results" id="noResults" style="display: none;">
                üö´ No trains found for this route. Please try different stations or check back later.
            </div>
        </div>
    </div>

    <script>
        // City stations data for local/metro trains
        const cityStations = {
            mumbai: {
                name: "Mumbai Local Trains",
                icon: "üöÜ",
                stations: [
                    "Churchgate (CCG)", "Marine Lines (MEL)", "Charni Road (CYR)",
                    "Grant Road (GTR)", "Mumbai Central (BCT)", "Dadar (DR)",
                    "Matunga Road (MRU)", "Mahim Junction (MM)", "Bandra (BA)",
                    "Khar Road (KHAR)", "Santacruz (STC)", "Vile Parle (VLP)",
                    "Andheri (ADH)", "Jogeshwari (JOS)", "Goregaon (GMN)",
                    "Malad (MDD)", "Kandivali (KNDI)", "Borivali (BVI)",
                    "Dahisar (DIC)", "Mira Road (MIRA)", "Bhayandar (BYR)",
                    "Naigaon (NIG)", "Vasai Road (BSR)", "Nallasopara (NSP)",
                    "Virar (VR)"
                ]
            },
            pune: {
                name: "Pune Metro & Local Trains",
                icon: "üöá",
                stations: [
                    "Pimpri Chinchwad (PC)", "Kasarwadi", "Phugewadi",
                    "Dapodi", "Bopodi", "Khadki",
                    "Shivaji Nagar", "Pune Station (PUNE)",
                    "District Court", "Civil Court",
                    "Budhwar Peth", "Mandai", "Swargate",
                    "Katraj", "Vanaz", "Anand Nagar",
                    "Ideal Colony", "Nal Stop", "Garware College",
                    "Deccan Gymkhana", "Chhatrapati Sambhaji Park"
                ]
            },
            delhi: {
                name: "Delhi Metro",
                icon: "üöá",
                stations: [
                    "Kashmere Gate (KG)", "Rajiv Chowk (RC)",
                    "New Delhi (NDLS)", "Chandni Chowk (CC)",
                    "Central Secretariat (CS)", "Connaught Place (CP)",
                    "Karol Bagh (KB)", "Rajendra Place (RP)",
                    "Patel Nagar (PN)", "Shadipur (SP)",
                    "Kirti Nagar (KN)", "Moti Nagar (MN)",
                    "Ramesh Nagar (RN)", "Rajouri Garden (RG)",
                    "Tagore Garden (TG)", "Subhash Nagar (SN)",
                    "Tilak Nagar (TN)", "Janakpuri East (JKE)",
                    "Janakpuri West (JKW)", "Uttam Nagar East (UNE)",
                    "Uttam Nagar West (UNW)"
                ]
            },
            kolkata: {
                name: "Kolkata Metro & Local",
                icon: "üöÜ",
                stations: [
                    "Dum Dum (DDJ)", "Belgachia (BGA)",
                    "Shyambazar (SYB)", "Sovabazar Sutanuti (SVS)",
                    "Girish Park (GP)", "Mahatma Gandhi Road (MGR)",
                    "Central (CT)", "Chandni Chowk (CCK)",
                    "Esplanade (ESP)", "Park Street (PKST)",
                    "Maidan (MDN)", "Rabindra Sadan (RS)",
                    "Netaji Bhavan (NB)", "Jatin Das Park (JDP)",
                    "Kalighat (KGT)", "Rabindra Sarobar (RBS)",
                    "Mahanayak Uttam Kumar (MUK)", "Netaji (NTJ)",
                    "Masterda Surya Sen (MSS)", "Gitanjali (GTJ)"
                ]
            },
            chennai: {
                name: "Chennai Metro & Local",
                icon: "üöá",
                stations: [
                    "Chennai Central (MAS)", "Egmore (MS)",
                    "Chennai Beach (MB)", "Chennai Fort (MSF)",
                    "Park Town (PT)", "Chintadripet (MTC)",
                    "Chepauk (CPK)", "Triplicane (TPC)",
                    "Thiruvallikeni (TVK)", "Mylapore (MP)",
                    "Mundakakanni Amman Koil (MAK)", "Greenways Road (GRD)",
                    "Kotturpuram (KPM)", "Kasturba Nagar (KSN)",
                    "Indira Nagar (IDR)", "Thiruvanmiyur (TVM)",
                    "Taramani (TRM)", "Thoraipakkam (TPK)",
                    "Sholinganallur (SHL)", "Karapakkam (KPK)"
                ]
            },
            bangalore: {
                name: "Bangalore Metro (Namma Metro)",
                icon: "üöá",
                stations: [
                    "Baiyappanahalli (BYPL)", "Swami Vivekananda Road (SVR)",
                    "Indiranagar (INR)", "Halasuru (HLS)",
                    "Trinity (TRY)", "MG Road (MGR)",
                    "Cubbon Park (CBP)", "Vidhana Soudha (VDS)",
                    "Sir M. Visveshwaraya (SMV)", "Majestic (MJS)",
                    "City Railway Station (CRS)", "Magadi Road (MGRD)",
                    "Srirampura (SRP)", "Kengeri (KGR)",
                    "Rajajinagar (RJN)", "Mahalakshmi (MLK)",
                    "Sandal Soap Factory (SSF)", "Yeshwanthpur (YPR)",
                    "Nagasandra (NGS)", "Dasarahalli (DSR)"
                ]
            },
            hyderabad: {
                name: "Hyderabad Metro",
                icon: "üöá",
                stations: [
                    "Miyapur (MYP)", "JNTU College (JNT)",
                    "KPHB Colony (KPH)", "Kukatpally (KUK)",
                    "Balanagar (BLN)", "Moosapet (MSP)",
                    "Bharat Nagar (BRT)", "Erragadda (ERG)",
                    "ESI Hospital (ESI)", "SR Nagar (SRN)",
                    "Ameerpet (AMR)", "Punjagutta (PJT)",
                    "Irrum Manzil (IRM)", "Khairatabad (KHB)",
                    "Lakdikapul (LKP)", "Assembly (ASB)",
                    "Nampally (NPL)", "Gandhi Bhavan (GBV)",
                    "Osmania Medical College (OMC)", "MG Bus Station (MGB)"
                ]
            },
            kochi: {
                name: "Kochi Metro",
                icon: "üöá",
                stations: [
                    "Aluva (ALV)", "Pulinchodu (PLD)",
                    "Companypady (CMP)", "Ambattukavu (AMB)",
                    "Muttom (MTM)", "Kalamassery (KLM)",
                    "Cochin University (CUN)", "Pathadipalam (PDP)",
                    "Edapally (EDP)", "Changampuzha Park (CHP)",
                    "Palarivattom (PLV)", "JLN Stadium (JLN)",
                    "Kaloor (KLR)", "Lissie (LIS)",
                    "MG Road (MGR)", "Maharaja's College (MJC)",
                    "Ernakulam South (ERS)", "Kadavanthra (KDV)",
                    "Elamkulam (ELM)", "Vyttila (VYT)"
                ]
            }
        };

        // Train types for city trains
        const trainTypes = {
            metro: {
                name: "Metro Train",
                frequency: "Every 5-10 minutes",
                classes: ["First", "Second", "AC", "Ladies"],
                speed: "80 km/h",
                amenities: ["AC", "WiFi", "LED Display", "Security Cameras", "Priority Seating"]
            },
            local: {
                name: "Local Train",
                frequency: "Every 15-30 minutes",
                classes: ["First", "Second", "Ladies", "Handicap"],
                speed: "60 km/h",
                amenities: ["Fans", "LED Display", "Security", "Priority Seating"]
            },
            express: {
                name: "Express Metro",
                frequency: "Every 10-15 minutes",
                classes: ["First", "AC", "Business"],
                speed: "100 km/h",
                amenities: ["AC", "WiFi", "Charging Ports", "LED Display", "Security"]
            },
            suburban: {
                name: "Suburban Train",
                frequency: "Every 20-30 minutes",
                classes: ["First", "Second", "Ladies"],
                speed: "70 km/h",
                amenities: ["Fans", "LED Display", "Security"]
            }
        };

        // Class details
        const classDetails = {
            "First": { name: "First Class", priceMultiplier: 3, amenities: ["Comfortable Seats", "Less Crowded", "Priority"] },
            "Second": { name: "Second Class", priceMultiplier: 1, amenities: ["Standard Seats"] },
            "AC": { name: "AC Class", priceMultiplier: 4, amenities: ["Air Conditioning", "Comfortable Seats", "Less Crowded"] },
            "Ladies": { name: "Ladies Special", priceMultiplier: 1.5, amenities: ["Women Only", "Security", "Priority"] },
            "Business": { name: "Business Class", priceMultiplier: 5, amenities: ["Premium Seats", "WiFi", "Charging", "Newspaper"] },
            "Handicap": { name: "Handicap Friendly", priceMultiplier: 1, amenities: ["Wheelchair Access", "Priority Seating", "Assistance"] }
        };

        // Ticket type multipliers
        const ticketTypeMultipliers = {
            "single": 1,
            "return": 1.8, // 10% discount
            "daily": 5, // Unlimited rides for day
            "weekly": 20, // Unlimited rides for week
            "monthly": 70 // Unlimited rides for month
        };

        let selectedTrainClass = null;

        function updateStations() {
            const city = document.getElementById('city').value;
            const fromSelect = document.getElementById('fromStation');
            const toSelect = document.getElementById('toStation');
            
            if (city && cityStations[city]) {
                fromSelect.disabled = false;
                toSelect.disabled = false;
                
                // Clear existing options
                fromSelect.innerHTML = '<option value="">-- Select Station --</option>';
                toSelect.innerHTML = '<option value="">-- Select Station --</option>';
                
                // Add stations to dropdowns
                cityStations[city].stations.forEach(station => {
                    const fromOption = document.createElement('option');
                    fromOption.value = station;
                    fromOption.textContent = station;
                    fromSelect.appendChild(fromOption);
                    
                    const toOption = document.createElement('option');
                    toOption.value = station;
                    toOption.textContent = station;
                    toSelect.appendChild(toOption);
                });
            } else {
                fromSelect.disabled = true;
                toSelect.disabled = true;
                fromSelect.innerHTML = '<option value="">-- Select Station --</option>';
                toSelect.innerHTML = '<option value="">-- Select Station --</option>';
            }
        }

        function searchTrains() {
            const city = document.getElementById('city').value;
            const fromStation = document.getElementById('fromStation').value;
            const toStation = document.getElementById('toStation').value;
            const date = document.getElementById('date').value;
            const travelClass = document.getElementById('class').value;
            const ticketType = document.getElementById('ticketType').value;
            const passengers = document.getElementById('passengers').value;
            const timePreference = document.getElementById('time').value;
            
            // Validation
            if (!city || !fromStation || !toStation) {
                alert('Please select city and both stations');
                return;
            }
            
            if (fromStation === toStation) {
                alert('From and To stations cannot be the same');
                return;
            }
            
            // Show results section
            document.getElementById('resultsSection').style.display = 'block';
            document.getElementById('loading').style.display = 'block';
            document.getElementById('noResults').style.display = 'none';
            document.getElementById('trainResults').innerHTML = '';
            
            // Update city info
            document.getElementById('cityIcon').textContent = cityStations[city].icon;
            document.getElementById('cityName').textContent = cityStations[city].name;
            
            // Update route info
            document.getElementById('routeInfo').textContent = `${fromStation} ‚Üí ${toStation}`;
            document.getElementById('dateInfo').textContent = new Date(date).toLocaleDateString('en-US', { 
                weekday: 'long', 
                year: 'numeric', 
                month: 'long', 
                day: 'numeric' 
            });
            document.getElementById('ticketTypeInfo').textContent = ticketType.charAt(0).toUpperCase() + ticketType.slice(1);
            
            // Simulate API call delay
            setTimeout(() => {
                generateTrainResults(city, fromStation, toStation, date, travelClass, ticketType, timePreference);
            }, 1500);
        }

        function generateTrainResults(city, fromStation, toStation, date, travelClass, ticketType, timePreference) {
            const trainResults = document.getElementById('trainResults');
            const loading = document.getElementById('loading');
            const noResults = document.getElementById('noResults');
            
            loading.style.display = 'none';
            trainResults.innerHTML = '';
            
            // Generate 15-20 trains
            const numTrains = Math.floor(Math.random() * 6) + 15; // 15-20 trains
            const trains = [];
            
            // Get city train type
            const cityData = cityStations[city];
            const isMetro = cityData.name.includes("Metro");
            const trainType = isMetro ? "metro" : 
                             city === "mumbai" ? "local" :
                             city === "kolkata" ? "suburban" : "express";
            
            // Generate departure times based on time preference
            let startHour = 5;
            let endHour = 23;
            
            switch(timePreference) {
                case "morning":
                    startHour = 6;
                    endHour = 12;
                    break;
                case "afternoon":
                    startHour = 12;
                    endHour = 16;
                    break;
                case "evening":
                    startHour = 16;
                    endHour = 20;
                    break;
                case "night":
                    startHour = 20;
                    endHour = 23;
                    break;
            }
            
            // Generate trains with different departure times
            for (let i = 0; i < numTrains; i++) {
                const hour = startHour + Math.floor((endHour - startHour) * i / numTrains);
                const minute = Math.floor(Math.random() * 60);
                const departureTime = `${hour.toString().padStart(2, '0')}:${minute.toString().padStart(2, '0')}`;
                
                trains.push(createCityTrain(i + 1, city, fromStation, toStation, departureTime, trainType, ticketType));
            }
            
            if (trains.length === 0) {
                noResults.style.display = 'block';
                document.getElementById('resultsCount').textContent = '0 trains found';
                return;
            }
            
            document.getElementById('resultsCount').textContent = `${trains.length} trains found`;
            
            // Display trains
            trains.forEach(train => {
                const trainCard = createTrainCard(train, travelClass);
                trainResults.appendChild(trainCard);
            });
        }

        function createCityTrain(trainNumber, city, fromStation, toStation, departureTime, trainType, ticketType) {
            const typeInfo = trainTypes[trainType];
            const duration = Math.floor(Math.random() * 30) + 10; // 10-40 minutes
            
            // Calculate arrival time
            const [depHour, depMinute] = departureTime.split(':').map(Number);
            const totalMinutes = depHour * 60 + depMinute + duration;
            const arrivalHour = Math.floor(totalMinutes / 60) % 24;
            const arrivalMinute = totalMinutes % 60;
            const arrivalTime = `${arrivalHour.toString().padStart(2, '0')}:${arrivalMinute.toString().padStart(2, '0')}`;
            
            // Calculate base price based on distance and city
            let basePrice = 10;
            switch(city) {
                case "mumbai": basePrice = 15; break;
                case "delhi": basePrice = 12; break;
                case "bangalore": basePrice = 14; break;
                case "chennai": basePrice = 13; break;
                case "kolkata": basePrice = 11; break;
                case "hyderabad": basePrice = 12; break;
                case "pune": basePrice = 10; break;
                case "kochi": basePrice = 10; break;
            }
            
            // Generate train classes based on train type
            const classes = [];
            typeInfo.classes.forEach(cls => {
                const classDetail = classDetails[cls];
                const price = Math.round(basePrice * classDetail.priceMultiplier * ticketTypeMultipliers[ticketType]);
                const availability = Math.floor(Math.random() * 30) + 10; // 10-40 seats
                
                classes.push({
                    code: cls,
                    name: classDetail.name,
                    price: price,
                    availability: availability,
                    amenities: classDetail.amenities
                });
            });
            
            return {
                number: `CT${trainNumber.toString().padStart(3, '0')}`,
                name: `${city.charAt(0).toUpperCase() + city.slice(1)} ${typeInfo.name}`,
                type: typeInfo.name,
                departure: departureTime,
                arrival: arrivalTime,
                duration: duration,
                fromStation: fromStation,
                toStation: toStation,
                classes: classes,
                amenities: typeInfo.amenities,
                frequency: typeInfo.frequency,
                speed: typeInfo.speed,
                stationsBetween: Math.floor(Math.random() * 8) + 3 // 3-10 stations
            };
        }

        function createTrainCard(train, selectedClass) {
            const card = document.createElement('div');
            card.className = 'train-card';
            
            // Randomly mark some trains as express or popular
            if (Math.random() > 0.7) {
                const badge = document.createElement('div');
                badge.className = 'success-badge';
                badge.textContent = train.type.includes("Express") ? 'Express' : 'Popular';
                card.appendChild(badge);
            }
            
            card.innerHTML = `
                <div class="train-header">
                    <div class="train-name">
                        <div class="train-number">${train.number}</div>
                        <div class="train-title">${train.name}</div>
                    </div>
                    <div class="train-type">${train.type}</div>
                </div>
                
                <div class="journey-timeline">
                    <div class="timeline-station">
                        <div class="station-name">${train.fromStation.split('(')[0]}</div>
                        <div class="station-time">${train.departure}</div>
                    </div>
                    <div class="timeline-track"></div>
                    <div class="timeline-station">
                        <div class="station-name">${train.toStation.split('(')[0]}</div>
                        <div class="station-time">${train.arrival}</div>
                    </div>
                </div>
                
                <div class="train-details">
                    <div class="detail-item">
                        <span class="detail-label">Duration</span>
                        <span class="detail-value">${train.duration} min</span>
                    </div>
                    <div class="detail-item">
                        <span class="detail-label">Frequency</span>
                        <span class="detail-value">${train.frequency}</span>
                    </div>
                    <div class="detail-item">
                        <span class="detail-label">Speed</span>
                        <span class="detail-value">${train.speed}</span>
                    </div>
                    <div class="detail-item">
                        <span class="detail-label">Stops</span>
                        <span class="detail-value">${train.stationsBetween}</span>
                    </div>
                </div>
                
                <h4 style="margin: 20px 0 10px; color: #00695c;">Available Classes</h4>
                <div class="train-classes" id="classes-${train.number}">
                    ${train.classes.map(cls => `
                        <div class="class-card" onclick="selectClass(${train.number}, '${cls.code}')">
                            <div class="class-name">${cls.name}</div>
                            <div class="class-price">‚Çπ${cls.price}</div>
                            <div class="class-availability">${cls.availability} seats left</div>
                        </div>
                    `).join('')}
                </div>
                
                <div class="train-footer">
                    <div class="train-amenities">
                        ${train.amenities.map(amenity => `
                            <div class="amenity">‚úì ${amenity}</div>
                        `).join('')}
                    </div>
                    <button class="book-button" onclick="bookTrain(${train.number})" id="book-${train.number}" disabled>
                        Select Class First
                    </button>
                </div>
            `;
            
            return card;
        }

        function selectClass(trainNumber, classCode) {
            selectedTrainClass = { trainNumber, classCode };
            
            // Reset all class selections for this train
            const classCards = document.querySelectorAll(`#classes-${trainNumber} .class-card`);
            classCards.forEach(card => {
                card.classList.remove('selected');
            });
            
            // Find and mark selected class
            classCards.forEach(card => {
                if (card.querySelector('.class-name').textContent.includes(classCode)) {
                    card.classList.add('selected');
                }
            });
            
            // Enable book button
            const bookButton = document.getElementById(`book-${trainNumber}`);
            if (bookButton) {
                bookButton.disabled = false;
                bookButton.textContent = 'Book Now';
                bookButton.onclick = () => bookTrain(trainNumber, classCode);
            }
        }

        function bookTrain(trainNumber, classCode) {
            const city = document.getElementById('city').value;
            const fromStation = document.getElementById('fromStation').value;
            const toStation = document.getElementById('toStation').value;
            const date = document.getElementById('date').value;
            const ticketType = document.getElementById('ticketType').value;
            const passengers = document.getElementById('passengers').value;
            
            const classDetail = classDetails[classCode];
            const cityName = cityStations[city].name;
            
            alert(`üé´ City Train Ticket Confirmed!\n\n` +
                  `Train #${trainNumber}\n` +
                  `City: ${cityName}\n` +
                  `Route: ${fromStation.split('(')[0]} ‚Üí ${toStation.split('(')[0]}\n` +
                  `Date: ${new Date(date).toDateString()}\n` +
                  `Ticket Type: ${ticketType.charAt(0).toUpperCase() + ticketType.slice(1)}\n` +
                  `Class: ${classDetail.name}\n` +
                  `Passengers: ${passengers}\n\n` +
                  `Please proceed to collect your ticket/token.`);
        }

        // Initialize date to today
        document.getElementById('date').valueAsDate = new Date();
        document.getElementById('date').min = new Date().toISOString().split('T')[0];
        
        // Set max date to 30 days from now
        const maxDate = new Date();
        maxDate.setDate(maxDate.getDate() + 30);
        document.getElementById('date').max = maxDate.toISOString().split('T')[0];
    </script>
</body>
</html>