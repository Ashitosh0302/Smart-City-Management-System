<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hospital | Patient Appointments Dashboard</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">

    <style>
        :root {
            --primary-hospital: #0066cc;
            --secondary-hospital: #2a9d8f;
            --accent-hospital: #e63946;
            --light-hospital: #f8f9fa;
            --success-hospital: #27ae60;
            --warning-hospital: #f39c12;
            --danger-hospital: #e74c3c;
            --info-hospital: #3498db;
            --teal-hospital: #1abc9c;
            --text-dark: #2c3e50;
            --text-light: #7f8c8d;
            --border-color: #dee2e6;
            --shadow-sm: 0 1px 3px rgba(0, 0, 0, 0.1);
            --shadow-md: 0 4px 6px rgba(0, 0, 0, 0.07);
            --shadow-lg: 0 10px 15px rgba(0, 0, 0, 0.1);
            --transition: all 0.3s ease;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', 'Roboto', 'Helvetica Neue', sans-serif;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            color: var(--text-dark);
            line-height: 1.6;
        }

        /* Hospital Header */
        .hospital-header {
            background: linear-gradient(135deg, var(--primary-hospital) 0%, #004d99 100%);
            color: white;
            padding: 1.25rem 2rem;
            position: sticky;
            top: 0;
            z-index: 1000;
            box-shadow: var(--shadow-md);
            border-bottom: 4px solid var(--teal-hospital);
        }

        .header-container {
            max-width: 1400px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo-section {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .hospital-logo {
            width: 60px;
            height: 60px;
            background: rgba(255, 255, 255, 0.15);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2rem;
            border: 3px solid white;
        }

        .hospital-title h1 {
            font-size: 1.5rem;
            font-weight: 600;
            margin-bottom: 0.25rem;
            letter-spacing: 0.5px;
        }

        .hospital-subtitle {
            font-size: 0.9rem;
            opacity: 0.9;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .badge-hospital {
            background: var(--teal-hospital);
            color: white;
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
        }

        .header-actions {
            display: flex;
            align-items: center;
            gap: 1.5rem;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.75rem 1.5rem;
            background: rgba(255, 255, 255, 0.15);
            border-radius: 50px;
            border: 2px solid rgba(255, 255, 255, 0.2);
        }

        .user-avatar {
            width: 40px;
            height: 40px;
            background: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--primary-hospital);
            font-weight: bold;
        }

        .logout-btn-header {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            background: rgba(255, 255, 255, 0.15);
            color: white;
            border: 2px solid rgba(255, 255, 255, 0.2);
            padding: 0.75rem 1.5rem;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            text-decoration: none;
        }

        .logout-btn-header:hover {
            background: rgba(255, 255, 255, 0.25);
            border-color: white;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
        }

        /* Main Container */
        .main-container {
            max-width: 1400px;
            margin: 2rem auto;
            padding: 0 2rem;
            display: flex;
            gap: 2rem;
            min-height: calc(100vh - 140px);
        }

        /* Sidebar */
        .hospital-sidebar {
            width: 280px;
            flex-shrink: 0;
        }

        .sidebar-card {
            background: white;
            border-radius: 15px;
            box-shadow: var(--shadow-md);
            overflow: hidden;
            margin-bottom: 1.5rem;
            border: none;
        }

        .sidebar-header {
            background: linear-gradient(135deg, var(--primary-hospital) 0%, #004d99 100%);
            color: white;
            padding: 1.5rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 0.75rem;
            border-bottom: 3px solid var(--teal-hospital);
        }

        .nav-menu {
            list-style: none;
        }

        .nav-item {
            border-bottom: 1px solid var(--border-color);
            transition: var(--transition);
        }

        .nav-item:hover {
            background: #f0f7ff;
        }

        .nav-item:last-child {
            border-bottom: none;
        }

        .nav-link {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 1.25rem 1.5rem;
            color: var(--text-dark);
            text-decoration: none;
            transition: var(--transition);
            position: relative;
        }

        .nav-link:hover {
            background: #f0f7ff;
            color: var(--primary-hospital);
            padding-left: 2rem;
        }

        .nav-link.active {
            background: #e3f2fd;
            color: var(--primary-hospital);
            border-left: 5px solid var(--teal-hospital);
            font-weight: 600;
        }

        .nav-link i {
            width: 24px;
            text-align: center;
            font-size: 1.3rem;
        }

        .badge {
            background: var(--accent-hospital);
            color: white;
            font-size: 0.75rem;
            padding: 0.25rem 0.75rem;
            border-radius: 15px;
            margin-left: auto;
            font-weight: 600;
        }

        /* Content Area */
        .content-area {
            flex: 1;
        }

        /* Dashboard Header */
        .dashboard-header {
            margin-bottom: 2rem;
        }

        .welcome-card {
            background: linear-gradient(135deg, #ffffff 0%, #f0f7ff 100%);
            border-radius: 15px;
            padding: 2rem;
            box-shadow: var(--shadow-md);
            border-left: 6px solid var(--teal-hospital);
            position: relative;
            overflow: hidden;
        }

        .welcome-card::before {
            content: '';
            position: absolute;
            top: 0;
            right: 0;
            width: 200px;
            height: 100%;
            background: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 200 200'%3E%3Cpath fill='%231abc9c' fill-opacity='0.05' d='M0,0 L200,0 L200,200 Z'%3E%3C/path%3E%3C/svg%3E");
        }

        .welcome-content h2 {
            font-size: 1.75rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
            color: var(--primary-hospital);
        }

        .welcome-content p {
            color: var(--text-light);
            max-width: 600px;
            margin-bottom: 1.5rem;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 1.5rem;
            margin-top: 1.5rem;
        }

        .stat-card {
            background: white;
            border-radius: 12px;
            padding: 1.5rem;
            box-shadow: var(--shadow-sm);
            transition: var(--transition);
            border: 2px solid transparent;
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 4px;
            background: linear-gradient(90deg, var(--teal-hospital), var(--secondary-hospital));
        }

        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-md);
        }

        .stat-icon {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 1rem;
            font-size: 1.5rem;
            color: white;
        }

        .stat-icon.total {
            background: linear-gradient(135deg, var(--primary-hospital), #004d99);
        }

        .stat-icon.pending {
            background: linear-gradient(135deg, var(--warning-hospital), #e67e22);
        }

        .stat-icon.confirmed {
            background: linear-gradient(135deg, var(--success-hospital), #27ae60);
        }

        .stat-icon.cancelled {
            background: linear-gradient(135deg, var(--danger-hospital), #c0392b);
        }

        .stat-value {
            font-size: 2.5rem;
            font-weight: 800;
            margin-bottom: 0.5rem;
            color: var(--text-dark);
        }

        .stat-label {
            color: var(--text-light);
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 1px;
            font-weight: 600;
        }

        /* Quick Actions */
        .quick-actions {
            display: flex;
            gap: 1rem;
            flex-wrap: wrap;
            margin-top: 1rem;
        }

        .quick-btn {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.75rem 1.5rem;
            background: white;
            border: 2px solid var(--border-color);
            border-radius: 10px;
            color: var(--text-dark);
            text-decoration: none;
            font-weight: 600;
            transition: var(--transition);
        }

        .quick-btn:hover {
            background: var(--primary-hospital);
            color: white;
            border-color: var(--primary-hospital);
            transform: translateY(-2px);
        }

        /* Modal Overlay */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 2000;
            padding: 20px;
        }

        .modal-overlay.active {
            display: flex;
        }

        .modal-content {
            background: white;
            border-radius: 15px;
            width: 100%;
            max-width: 800px;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: var(--shadow-lg);
            animation: modalSlideIn 0.3s ease;
        }

        @keyframes modalSlideIn {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .modal-header {
            background: linear-gradient(135deg, var(--primary-hospital) 0%, #004d99 100%);
            color: white;
            padding: 1.5rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-radius: 15px 15px 0 0;
            border-bottom: 3px solid var(--teal-hospital);
        }

        .modal-header h3 {
            font-size: 1.5rem;
            font-weight: 600;
            margin: 0;
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .modal-close {
            background: none;
            border: none;
            color: white;
            font-size: 1.5rem;
            cursor: pointer;
            padding: 0.5rem;
            transition: var(--transition);
        }

        .modal-close:hover {
            transform: rotate(90deg);
        }

        .modal-body {
            padding: 2rem;
        }

        .modal-footer {
            padding: 1.5rem;
            border-top: 1px solid var(--border-color);
            display: flex;
            justify-content: flex-end;
            gap: 1rem;
        }

        /* Appointments Section */
        .appointments-section {
            background: white;
            border-radius: 15px;
            box-shadow: var(--shadow-md);
            overflow: hidden;
            border: none;
            margin-bottom: 2rem;
        }

        .section-header {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            padding: 1.5rem;
            border-bottom: 2px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .section-header h2 {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--primary-hospital);
            display: flex;
            align-items: center;
            gap: 1rem;
            margin: 0;
        }

        .section-header h2 i {
            color: var(--teal-hospital);
            font-size: 1.3rem;
        }

        .table-container {
            overflow-x: auto;
        }

        .appointments-table {
            width: 100%;
            border-collapse: collapse;
        }

        .table-header {
            background: #f8f9fa;
        }

        .table-header th {
            padding: 1.25rem 1.5rem;
            text-align: left;
            font-weight: 600;
            color: var(--primary-hospital);
            border-bottom: 2px solid var(--border-color);
            white-space: nowrap;
        }

        .table-row {
            border-bottom: 1px solid var(--border-color);
            transition: var(--transition);
        }

        .table-row:hover {
            background: #f8f9fa;
        }

        .table-row:last-child {
            border-bottom: none;
        }

        .table-row td {
            padding: 1.25rem 1.5rem;
            vertical-align: middle;
        }

        .patient-id {
            font-family: 'Courier New', monospace;
            font-weight: 700;
            color: var(--primary-hospital);
            font-size: 0.95rem;
        }

        .patient-info {
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .patient-avatar {
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, var(--secondary-hospital), var(--teal-hospital));
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            font-size: 0.9rem;
        }

        .patient-details {
            line-height: 1.4;
        }

        .patient-name {
            font-weight: 600;
            color: var(--text-dark);
        }

        .patient-age {
            font-size: 0.85rem;
            color: var(--text-light);
        }

        .department-badge {
            display: inline-block;
            padding: 0.5rem 1rem;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 600;
            text-align: center;
            min-width: 100px;
        }

        .dept-cardiology {
            background: linear-gradient(135deg, #ff6b6b, #ee5a52);
            color: white;
        }

        .dept-neurology {
            background: linear-gradient(135deg, #48cae4, #0096c7);
            color: white;
        }

        .dept-orthopedics {
            background: linear-gradient(135deg, #52b788, #2d6a4f);
            color: white;
        }

        .dept-pediatrics {
            background: linear-gradient(135deg, #ffd166, #f4a261);
            color: white;
        }

        .dept-general {
            background: linear-gradient(135deg, #b8c1ec, #6247aa);
            color: white;
        }

        .status-badge {
            display: inline-block;
            padding: 0.5rem 1rem;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 600;
            text-align: center;
            min-width: 100px;
        }

        .status-pending {
            background: linear-gradient(135deg, var(--warning-hospital), #f1c40f);
            color: white;
        }

        .status-confirmed {
            background: linear-gradient(135deg, var(--success-hospital), #2ecc71);
            color: white;
        }

        .status-cancelled {
            background: linear-gradient(135deg, var(--danger-hospital), #e74c3c);
            color: white;
        }

        .status-completed {
            background: linear-gradient(135deg, var(--info-hospital), #3498db);
            color: white;
        }

        .urgency-badge {
            display: inline-block;
            padding: 0.4rem 0.8rem;
            border-radius: 6px;
            font-size: 0.8rem;
            font-weight: 600;
        }

        .urgency-normal {
            background: #e8f5e9;
            color: #2e7d32;
            border: 1px solid #c8e6c9;
        }

        .urgency-urgent {
            background: #fff3e0;
            color: #ef6c00;
            border: 1px solid #ffe0b2;
        }

        .urgency-emergency {
            background: #ffebee;
            color: #c62828;
            border: 1px solid #ffcdd2;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% {
                opacity: 1;
            }

            50% {
                opacity: 0.7;
            }

            100% {
                opacity: 1;
            }
        }

        .time-badge {
            display: inline-block;
            padding: 0.4rem 0.8rem;
            border-radius: 6px;
            font-size: 0.8rem;
            font-weight: 600;
        }

        .time-morning {
            background: #e3f2fd;
            color: #1565c0;
            border: 1px solid #bbdefb;
        }

        .time-afternoon {
            background: #f3e5f5;
            color: #7b1fa2;
            border: 1px solid #e1bee7;
        }

        .time-evening {
            background: #fff3e0;
            color: #ef6c00;
            border: 1px solid #ffe0b2;
        }

        .action-buttons {
            display: flex;
            gap: 0.75rem;
        }

        .action-btn {
            padding: 0.6rem 1.2rem;
            border: none;
            border-radius: 8px;
            font-size: 0.85rem;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            white-space: nowrap;
        }

        .btn-view {
            background: linear-gradient(135deg, var(--primary-hospital), #004d99);
            color: white;
        }

        .btn-view:hover {
            background: linear-gradient(135deg, #004d99, var(--primary-hospital));
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 102, 204, 0.3);
        }

        .btn-update {
            background: linear-gradient(135deg, var(--secondary-hospital), #1abc9c);
            color: white;
        }

        .btn-update:hover {
            background: linear-gradient(135deg, #1abc9c, var(--secondary-hospital));
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(42, 157, 143, 0.3);
        }

        .btn-prescribe {
            background: linear-gradient(135deg, var(--teal-hospital), #16a085);
            color: white;
        }

        .btn-prescribe:hover {
            background: linear-gradient(135deg, #16a085, var(--teal-hospital));
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(26, 188, 156, 0.3);
        }

        .btn-save {
            background: linear-gradient(135deg, var(--success-hospital), #27ae60);
            color: white;
            padding: 0.75rem 1.5rem;
        }

        .btn-save:hover {
            background: linear-gradient(135deg, #27ae60, var(--success-hospital));
            transform: translateY(-2px);
        }

        .btn-cancel {
            background: linear-gradient(135deg, var(--danger-hospital), #e74c3c);
            color: white;
            padding: 0.75rem 1.5rem;
        }

        .btn-cancel:hover {
            background: linear-gradient(135deg, #e74c3c, var(--danger-hospital));
            transform: translateY(-2px);
        }

        /* Filter Section */
        .filter-section {
            background: white;
            border-radius: 15px;
            box-shadow: var(--shadow-sm);
            margin-bottom: 1.5rem;
            border: none;
        }

        .filter-header {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            padding: 1rem 1.5rem;
            border-bottom: 1px solid var(--border-color);
        }

        .filter-body {
            padding: 1.5rem;
        }

        .form-control {
            border: 2px solid var(--border-color);
            border-radius: 10px;
            padding: 0.75rem;
            width: 100%;
            transition: var(--transition);
        }

        .form-control:focus {
            border-color: var(--primary-hospital);
            box-shadow: 0 0 0 3px rgba(0, 102, 204, 0.1);
            outline: none;
        }

        .form-select {
            border: 2px solid var(--border-color);
            border-radius: 10px;
            padding: 0.75rem;
            width: 100%;
            transition: var(--transition);
        }

        .form-select:focus {
            border-color: var(--primary-hospital);
            box-shadow: 0 0 0 3px rgba(0, 102, 204, 0.1);
            outline: none;
        }

        /* Appointment Details */
        .appointment-details {
            display: grid;
            gap: 1.5rem;
        }

        .detail-section {
            background: #f8f9fa;
            padding: 1.5rem;
            border-radius: 10px;
            border-left: 4px solid var(--teal-hospital);
        }

        .detail-section h4 {
            color: var(--primary-hospital);
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .detail-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
        }

        .detail-item {
            margin-bottom: 0.75rem;
        }

        .detail-label {
            font-weight: 600;
            color: var(--text-dark);
            margin-bottom: 0.25rem;
            display: block;
        }

        .detail-value {
            color: var(--text-light);
            padding: 0.5rem;
            background: white;
            border-radius: 6px;
            min-height: 40px;
            display: flex;
            align-items: center;
        }

        /* Update Form */
        .update-form {
            display: grid;
            gap: 1.5rem;
        }

        .form-group {
            margin-bottom: 1rem;
        }

        .form-group label {
            display: block;
            font-weight: 600;
            margin-bottom: 0.5rem;
            color: var(--text-dark);
        }

        .form-textarea {
            width: 100%;
            padding: 0.75rem;
            border: 2px solid var(--border-color);
            border-radius: 10px;
            font-size: 1rem;
            font-family: inherit;
            min-height: 100px;
            resize: vertical;
            transition: var(--transition);
        }

        .form-textarea:focus {
            outline: none;
            border-color: var(--primary-hospital);
            box-shadow: 0 0 0 3px rgba(0, 102, 204, 0.1);
        }

        /* Toast Notification */
        .toast {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: white;
            padding: 1rem 1.5rem;
            border-radius: 10px;
            box-shadow: var(--shadow-lg);
            display: flex;
            align-items: center;
            gap: 1rem;
            transform: translateX(150%);
            transition: transform 0.3s ease;
            z-index: 3000;
            border-left: 4px solid var(--success-hospital);
        }

        .toast.show {
            transform: translateX(0);
        }

        .toast i {
            color: var(--success-hospital);
            font-size: 1.2rem;
        }

        .toast-content {
            flex: 1;
        }

        .toast-title {
            font-weight: 600;
            margin-bottom: 0.25rem;
        }

        .toast-message {
            color: var(--text-light);
            font-size: 0.9rem;
        }

        /* Pagination */
        .pagination {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 1rem;
            padding: 1.5rem;
            border-top: 1px solid var(--border-color);
        }

        .page-btn {
            padding: 0.5rem 1rem;
            border: 2px solid var(--border-color);
            background: white;
            border-radius: 8px;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .page-btn:hover:not(:disabled) {
            background: var(--primary-hospital);
            color: white;
            border-color: var(--primary-hospital);
        }

        .page-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .page-info {
            color: var(--text-light);
            font-weight: 500;
        }

        /* Emergency Alert */
        .emergency-alert {
            background: linear-gradient(135deg, #ff6b6b, #c0392b);
            color: white;
            padding: 1rem 1.5rem;
            border-radius: 10px;
            margin-bottom: 1.5rem;
            display: flex;
            align-items: center;
            gap: 1rem;
            animation: pulse 2s infinite;
        }

        /* Responsive Design */
        @media (max-width: 1200px) {
            .main-container {
                flex-direction: column;
            }

            .hospital-sidebar {
                width: 100%;
            }

            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        @media (max-width: 768px) {
            .main-container {
                padding: 1rem;
            }

            .hospital-header {
                padding: 1rem;
            }

            .header-container {
                flex-direction: column;
                gap: 1rem;
                text-align: center;
            }

            .header-actions {
                width: 100%;
                justify-content: center;
                flex-wrap: wrap;
            }

            .stats-grid {
                grid-template-columns: 1fr;
                gap: 1rem;
            }

            .quick-actions {
                justify-content: center;
            }

            .table-header th,
            .table-row td {
                padding: 1rem;
            }

            .action-buttons {
                flex-direction: column;
            }

            .modal-content {
                margin: 0 1rem;
            }
        }

        @media (max-width: 480px) {
            .welcome-card {
                padding: 1.5rem;
            }

            .section-header {
                flex-direction: column;
                gap: 1rem;
                text-align: center;
            }

            .section-header h2 {
                font-size: 1.3rem;
            }

            .stat-value {
                font-size: 2rem;
            }

            .detail-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>

<body>
    <!-- Hospital Header -->
    <header class="hospital-header">
        <div class="header-container">
            <div class="logo-section">
                <div class="hospital-logo">
                    <i class="fas fa-hospital"></i>
                </div>
                <div class="hospital-title">
                    <h1>MediCare General Hospital</h1>
                    <p class="hospital-subtitle">
                        <i class="fas fa-map-marker-alt"></i>
                        Mumbai Central, Maharashtra
                        <span class="badge-hospital">24/7 Emergency</span>
                    </p>
                </div>
            </div>

            <div class="header-actions">
                <div class="user-info">
                    <div class="user-avatar">DR</div>
                    <div>
                        <div style="font-weight: 600;">Dr. Sarah Johnson</div>
                        <div style="font-size: 0.85rem; opacity: 0.9;">Chief Medical Officer</div>
                    </div>
                </div>
                <a href="/login/logout" class="logout-btn-header">
                    <i class="fas fa-sign-out-alt"></i>
                    Logout
                </a>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <div class="main-container">
        <!-- Sidebar Navigation -->
        <aside class="hospital-sidebar">
            <div class="sidebar-card">
                <div class="sidebar-header">
                    <i class="fas fa-stethoscope"></i>
                    Medical Dashboard
                </div>
                <ul class="nav-menu">
                    <li class="nav-item">
                        <a href="/hospital" class="nav-link">
                            <i class="fas fa-tachometer-alt"></i>
                            <span>Dashboard Overview</span>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a href="/hospital/appointments" class="nav-link active">
                            <i class="fas fa-calendar-check"></i>
                            <span>Patient Appointments</span>
                            <span class="badge" id="totalAppointmentsBadge">0</span>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a href="/hospital/patients" class="nav-link">
                            <i class="fas fa-user-injured"></i>
                            <span>Patient Records</span>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a href="/hospital/doctors" class="nav-link">
                            <i class="fas fa-user-md"></i>
                            <span>Doctor Schedule</span>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a href="/hospital/prescriptions" class="nav-link">
                            <i class="fas fa-prescription"></i>
                            <span>Prescriptions</span>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a href="/hospital/emergency" class="nav-link">
                            <i class="fas fa-ambulance"></i>
                            <span>Emergency Cases</span>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a href="/hospital/reports" class="nav-link">
                            <i class="fas fa-chart-line"></i>
                            <span>Medical Reports</span>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a href="/hospital/settings" class="nav-link">
                            <i class="fas fa-cog"></i>
                            <span>Hospital Settings</span>
                        </a>
                    </li>
                </ul>
            </div>

            <!-- Emergency Contacts -->
            <div class="sidebar-card">
                <div class="sidebar-header">
                    <i class="fas fa-phone-alt"></i>
                    Emergency Contacts
                </div>
                <div class="p-3">
                    <div class="mb-2">
                        <small class="text-muted d-block">Emergency Room</small>
                        <strong>022-1234-5678</strong>
                    </div>
                    <div class="mb-2">
                        <small class="text-muted d-block">Ambulance Service</small>
                        <strong>022-8765-4321</strong>
                    </div>
                    <div>
                        <small class="text-muted d-block">Pharmacy</small>
                        <strong>022-5555-6789</strong>
                    </div>
                </div>
            </div>
        </aside>

        <!-- Content Area -->
        <main class="content-area">
            <!-- Emergency Alert -->
            <div class="emergency-alert" id="emergencyAlert" style="display: none;">
                <i class="fas fa-exclamation-triangle fa-2x"></i>
                <div>
                    <strong>EMERGENCY CASE AVAILABLE</strong>
                    <div style="font-size: 0.9rem;">Priority case requires immediate attention</div>
                </div>
                <button class="action-btn btn-view" onclick="viewEmergencyCase()">
                    <i class="fas fa-eye"></i> View
                </button>
            </div>

            <!-- Dashboard Header -->
            <div class="dashboard-header">
                <div class="welcome-card">
                    <div class="welcome-content">
                        <h2><i class="fas fa-hospital-user mr-2"></i> Patient Appointments Management</h2>
                        <p>Manage patient appointments, consultations, and medical schedules efficiently</p>

                    </div>

                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-icon total">
                                <i class="fas fa-calendar-alt"></i>
                            </div>
                            <div class="stat-value" id="totalAppointments">0</div>
                            <div class="stat-label">Total Appointments</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon pending">
                                <i class="fas fa-clock"></i>
                            </div>
                            <div class="stat-value" id="pendingAppointments">0</div>
                            <div class="stat-label">Pending</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon confirmed">
                                <i class="fas fa-check-circle"></i>
                            </div>
                            <div class="stat-value" id="confirmedAppointments">0</div>
                            <div class="stat-label">Confirmed</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon cancelled">
                                <i class="fas fa-times-circle"></i>
                            </div>
                            <div class="stat-value" id="cancelledAppointments">0</div>
                            <div class="stat-label">Cancelled</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Filter Section -->
            <div class="filter-section">
                <div class="filter-header">
                    <h3 class="mb-0"><i class="fas fa-filter"></i> Filter Patient Appointments</h3>
                </div>
                <div class="filter-body">
                    <div class="row g-3">
                        <div class="col-md-3">
                            <label class="form-label">Appointment Status</label>
                            <select class="form-select" id="statusFilter">
                                <option value="all">All Status</option>
                                <option value="Pending">Pending</option>
                                <option value="Confirmed">Confirmed</option>
                                <option value="Completed">Completed</option>
                                <option value="Cancelled">Cancelled</option>
                            </select>
                        </div>
                        <div class="col-md-3">
                            <label class="form-label">Department</label>
                            <select class="form-select" id="departmentFilter">
                                <option value="all">All Departments</option>
                                <option value="Cardiology">Cardiology</option>
                                <option value="Neurology">Neurology</option>
                                <option value="Orthopedics">Orthopedics</option>
                                <option value="Pediatrics">Pediatrics</option>
                                <option value="General">General Medicine</option>
                            </select>
                        </div>
                        <div class="col-md-3">
                            <label class="form-label">Urgency Level</label>
                            <select class="form-select" id="urgencyFilter">
                                <option value="all">All Levels</option>
                                <option value="Normal">Normal</option>
                                <option value="Urgent">Urgent</option>
                                <option value="Emergency">Emergency</option>
                            </select>
                        </div>
                        <div class="col-md-3">
                            <label class="form-label">Search Patients</label>
                            <div class="input-group">
                                <input type="text" class="form-control" id="searchInput"
                                    placeholder="Search by name, ID, or phone...">
                                <button class="action-btn btn-view" onclick="filterAppointments()">
                                    <i class="fas fa-search"></i>
                                </button>
                                <button class="action-btn btn-cancel" onclick="clearFilters()">
                                    <i class="fas fa-times"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Appointments Table -->
            <section class="appointments-section">
                <div class="section-header">
                    <h2>
                        <i class="fas fa-list-ol"></i>
                        Patient Appointments List
                        <small class="ms-2 text-muted" id="tableCount">(0 appointments)</small>
                    </h2>
                    <button class="action-btn btn-view" onclick="loadAppointments()">
                        <i class="fas fa-sync-alt"></i> Refresh
                    </button>
                </div>

                <div class="table-container">
                    <table class="appointments-table">
                        <thead class="table-header">
                            <tr>
                                <th>Patient ID</th>
                                <th>Patient Information</th>
                                <th>Department</th>
                                <th>Appointment Date & Time</th>
                                <th>Urgency</th>
                                <th>Status</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="appointmentsTableBody">
                            <tr>
                                <td colspan="7" style="text-align: center; padding: 2rem;">
                                    <div class="spinner-border" style="color: var(--primary-hospital);" role="status">
                                        <span class="visually-hidden">Loading...</span>
                                    </div>
                                    <p class="mt-2">Loading patient appointments...</p>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <!-- Pagination -->
                <div class="pagination">
                    <button class="page-btn" id="prevBtn" onclick="changePage(-1)" disabled>
                        <i class="fas fa-chevron-left"></i> Previous
                    </button>
                    <span class="page-info" id="pageInfo">Page 1 of 1</span>
                    <button class="page-btn" id="nextBtn" onclick="changePage(1)" disabled>
                        Next <i class="fas fa-chevron-right"></i>
                    </button>
                </div>
            </section>
        </main>
    </div>

    <!-- View Appointment Modal -->
    <div class="modal-overlay" id="viewModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3><i class="fas fa-file-medical mr-2"></i> Patient Appointment Details</h3>
                <button class="modal-close" onclick="closeModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div class="appointment-details" id="appointmentDetails">
                    <!-- Details will be loaded here by JavaScript -->
                </div>
            </div>
            <div class="modal-footer">
                <button class="action-btn btn-update" onclick="updateAppointment(currentAppointmentId)">
                    <i class="fas fa-edit"></i> Update Status
                </button>
                <button class="action-btn btn-prescribe" onclick="prescribeMedication()">
                    <i class="fas fa-prescription"></i> Prescribe
                </button>
                <button class="action-btn btn-cancel" onclick="closeModal()">Close</button>
            </div>
        </div>
    </div>

    <!-- Update Appointment Modal -->
    <div class="modal-overlay" id="updateModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3><i class="fas fa-edit mr-2"></i> Update Appointment Status</h3>
                <button class="modal-close" onclick="closeModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div class="update-form" id="updateForm">
                    <!-- Update form will be loaded here by JavaScript -->
                </div>
            </div>
            <div class="modal-footer">
                <button class="action-btn btn-cancel" onclick="closeModal()">Cancel</button>
                <button class="action-btn btn-save" onclick="saveUpdate()">Save Changes</button>
            </div>
        </div>
    </div>

    <!-- Toast Notification -->
    <div class="toast" id="toast">
        <i class="fas fa-check-circle"></i>
        <div class="toast-content">
            <div class="toast-title" id="toastTitle">Success!</div>
            <div class="toast-message" id="toastMessage">Status updated successfully</div>
        </div>
    </div>

    <script>
        fetch("/hospital/appointments", {
            headers: {
                "Accept": "application/json"
            }
        })
            .then(res => res.json())
            .then(data => {
                console.log(data); // just to verify data is coming
            });


        // Global variables
        let currentAppointmentId = '';
        let allAppointments = [];
        let filteredAppointments = [];
        let currentPage = 1;
        const itemsPerPage = 10;

        // Load appointments on page load
        document.addEventListener('DOMContentLoaded', function () {
            console.log("‚úÖ Page loaded, fetching patient appointments...");
            loadAppointments();

            // Add event listeners for filter changes
            document.getElementById('statusFilter').addEventListener('change', filterAppointments);
            document.getElementById('departmentFilter').addEventListener('change', filterAppointments);
            document.getElementById('urgencyFilter').addEventListener('change', filterAppointments);
            document.getElementById('searchInput').addEventListener('keypress', function (e) {
                if (e.key === 'Enter') {
                    filterAppointments();
                }
            });

            // Simulate emergency alert (for demo)
            setTimeout(() => {
                showEmergencyAlert();
            }, 3000);
        });

        // Function to load appointments from backend
        async function loadAppointments() {
            try {
                console.log("üîÑ Fetching patient appointments from server...");

                // Show loading state
                document.getElementById('appointmentsTableBody').innerHTML = `
                    <tr>
                        <td colspan="7" style="text-align: center; padding: 2rem;">
                            <div class="spinner-border" style="color: var(--primary-hospital);" role="status">
                                <span class="visually-hidden">Loading...</span>
                            </div>
                            <p class="mt-2">Loading patient appointments...</p>
                        </td>
                    </tr>
                `;

                // Call the backend API for HOSPITAL appointments
                const response = await fetch('/hospital/appointments', {
                    credentials: 'include',
                    headers: {
                        'Accept': 'application/json'
                    }
                });

                console.log("üì° Response status:", response.status);

                if (!response.ok) {
                    throw new Error(`Server responded with ${response.status}`);
                }

                const data = await response.json();
                console.log("üì¶ Received hospital appointments data:", data);

                if (data.success) {
                    allAppointments = data.appointments || [];
                    console.log(`‚úÖ Loaded ${allAppointments.length} patient appointments`);
                } else {
                    console.warn("‚ö†Ô∏è Server returned success: false");
                    allAppointments = [];
                }

                // If no data from backend, use mock data
                if (allAppointments.length === 0) {
                    console.log("‚ö†Ô∏è Using mock hospital data for testing");
                    allAppointments = getMockHospitalAppointments();
                }

                // Initialize with all appointments
                filteredAppointments = [...allAppointments];

                // Update dashboard and table
                updateDashboardStats(allAppointments);
                renderAppointmentsTable();

                // Show success message if we have data
                if (allAppointments.length > 0) {
                    showToast(`Loaded ${allAppointments.length} patient appointments`, 'success');
                }

            } catch (error) {
                console.error('‚ùå Error loading patient appointments:', error);

                // Use mock data for testing
                console.log("‚ö†Ô∏è Using mock hospital data due to connection error");
                allAppointments = getMockHospitalAppointments();
                filteredAppointments = [...allAppointments];

                updateDashboardStats(allAppointments);
                renderAppointmentsTable();

                showToast('Using demo data - Backend connection issue', 'warning');
            }
        }

        // Mock data for hospital appointments
        function getMockHospitalAppointments() {
            const departments = ['Cardiology', 'Neurology', 'Orthopedics', 'Pediatrics', 'General'];
            const statuses = ['Pending', 'Confirmed', 'Completed', 'Cancelled'];
            const urgencies = ['Normal', 'Urgent', 'Emergency'];
            const doctors = ['Dr. Sharma', 'Dr. Patel', 'Dr. Singh', 'Dr. Verma', 'Dr. Kumar'];
            const times = ['9:00 AM', '10:30 AM', '11:45 AM', '2:00 PM', '3:30 PM', '4:45 PM'];

            const mockAppointments = [];
            const names = [
                'Rajesh Kumar', 'Priya Sharma', 'Amit Patel', 'Sneha Singh', 'Rohan Verma',
                'Anjali Mehta', 'Vikram Joshi', 'Neha Reddy', 'Sanjay Gupta', 'Pooja Nair',
                'Arun Mishra', 'Divya Kapoor', 'Kunal Desai', 'Tanya Rao', 'Rahul Bose'
            ];

            for (let i = 1; i <= 15; i++) {
                const department = departments[Math.floor(Math.random() * departments.length)];
                const status = statuses[Math.floor(Math.random() * statuses.length)];
                const urgency = urgencies[Math.floor(Math.random() * urgencies.length)];
                const doctor = doctors[Math.floor(Math.random() * doctors.length)];
                const time = times[Math.floor(Math.random() * times.length)];

                const name = names[i - 1];
                const initials = name.split(' ').map(n => n[0]).join('');

                // Generate realistic appointment dates
                const today = new Date();
                const appointmentDate = new Date(today);
                appointmentDate.setDate(today.getDate() + Math.floor(Math.random() * 30));

                mockAppointments.push({
                    _id: `hosp_${i}`,
                    appointmentId: `APPT-2024-${1000 + i}`,
                    patientId: `PID-${2024}${String(i).padStart(4, '0')}`,
                    fullName: name,
                    age: 20 + Math.floor(Math.random() * 50),
                    gender: i % 2 === 0 ? 'Male' : 'Female',
                    mobile: `98765${String(43210 + i).padStart(5, '0')}`,
                    email: `${name.toLowerCase().replace(' ', '.')}@email.com`,
                    address: `${i}${String.fromCharCode(65 + (i % 26))} Street, Mumbai`,
                    department: department,
                    doctorAssigned: doctor,
                    appointmentDate: appointmentDate.toISOString().split('T')[0],
                    appointmentTime: time,
                    symptoms: 'Fever, Headache, Fatigue',
                    urgency: urgency,
                    status: status,
                    insuranceProvider: i % 3 === 0 ? 'Not Insured' : 'ICICI Lombard',
                    medicalHistory: i % 4 === 0 ? 'Hypertension, Diabetes' : 'None',
                    notes: status === 'Completed' ? 'Prescribed medication, follow-up in 2 weeks' : '',
                    createdAt: new Date(Date.now() - i * 86400000).toISOString(),
                    updatedAt: new Date(Date.now() - i * 43200000).toISOString(),
                    initials: initials,
                    avatarColor: getRandomColor()
                });
            }

            return mockAppointments;
        }

        function getRandomColor() {
            const colors = ['#0066cc', '#2a9d8f', '#e63946', '#1abc9c', '#f39c12', '#9b59b6'];
            return colors[Math.floor(Math.random() * colors.length)];
        }

        // Function to filter appointments
        function filterAppointments() {
            const statusFilter = document.getElementById('statusFilter').value;
            const departmentFilter = document.getElementById('departmentFilter').value;
            const urgencyFilter = document.getElementById('urgencyFilter').value;
            const searchText = document.getElementById('searchInput').value.toLowerCase();

            // Start with all appointments
            filteredAppointments = [...allAppointments];

            // Apply status filter
            if (statusFilter !== 'all') {
                filteredAppointments = filteredAppointments.filter(appointment =>
                    appointment.status === statusFilter
                );
            }

            // Apply department filter
            if (departmentFilter !== 'all') {
                filteredAppointments = filteredAppointments.filter(appointment =>
                    appointment.department === departmentFilter
                );
            }

            // Apply urgency filter
            if (urgencyFilter !== 'all') {
                filteredAppointments = filteredAppointments.filter(appointment =>
                    appointment.urgency === urgencyFilter
                );
            }

            // Apply search filter
            if (searchText) {
                filteredAppointments = filteredAppointments.filter(appointment =>
                    (appointment.fullName && appointment.fullName.toLowerCase().includes(searchText)) ||
                    (appointment.appointmentId && appointment.appointmentId.toLowerCase().includes(searchText)) ||
                    (appointment.patientId && appointment.patientId.toLowerCase().includes(searchText)) ||
                    (appointment.mobile && appointment.mobile.includes(searchText))
                );
            }

            // Reset to first page
            currentPage = 1;

            // Update table
            renderAppointmentsTable();
        }

        // Function to clear all filters
        function clearFilters() {
            document.getElementById('statusFilter').value = 'all';
            document.getElementById('departmentFilter').value = 'all';
            document.getElementById('urgencyFilter').value = 'all';
            document.getElementById('searchInput').value = '';
            filterAppointments();
        }

        // Function to update dashboard statistics
        function updateDashboardStats(appointments) {
            const total = appointments.length;
            const pending = appointments.filter(a => a.status === 'Pending').length;
            const confirmed = appointments.filter(a => a.status === 'Confirmed').length;
            const completed = appointments.filter(a => a.status === 'Completed').length;
            const cancelled = appointments.filter(a => a.status === 'Cancelled').length;

            // Update stats cards
            document.getElementById('totalAppointments').textContent = total;
            document.getElementById('pendingAppointments').textContent = pending;
            document.getElementById('confirmedAppointments').textContent = confirmed;
            document.getElementById('cancelledAppointments').textContent = cancelled;

            // Update sidebar badge
            document.getElementById('totalAppointmentsBadge').textContent = total;
        }

        // Function to get department badge class
        function getDepartmentClass(dept) {
            switch (dept) {
                case 'Cardiology': return 'dept-cardiology';
                case 'Neurology': return 'dept-neurology';
                case 'Orthopedics': return 'dept-orthopedics';
                case 'Pediatrics': return 'dept-pediatrics';
                case 'General': return 'dept-general';
                default: return 'dept-general';
            }
        }

        // Function to get urgency badge class
        function getUrgencyClass(urgency) {
            switch (urgency) {
                case 'Normal': return 'urgency-normal';
                case 'Urgent': return 'urgency-urgent';
                case 'Emergency': return 'urgency-emergency';
                default: return 'urgency-normal';
            }
        }

        // Function to get time badge class
        function getTimeClass(time) {
            if (!time) return 'time-morning';
            const hour = parseInt(time.split(':')[0]);
            const isPM = time.includes('PM');
            const actualHour = isPM ? hour + 12 : hour;

            if (actualHour < 12) return 'time-morning';
            if (actualHour < 17) return 'time-afternoon';
            return 'time-evening';
        }

        // Function to format time for display
        function formatTime(time) {
            if (!time) return 'Not specified';
            return time;
        }

        // Function to format date for display
        function formatDate(dateString) {
            if (!dateString) return 'Not specified';
            const date = new Date(dateString);
            return date.toLocaleDateString('en-US', {
                weekday: 'short',
                year: 'numeric',
                month: 'short',
                day: 'numeric'
            });
        }

        // Function to render appointments table
        function renderAppointmentsTable() {
            const tbody = document.getElementById('appointmentsTableBody');

            // Calculate pagination
            const totalItems = filteredAppointments.length;
            const totalPages = Math.ceil(totalItems / itemsPerPage);
            const startIndex = (currentPage - 1) * itemsPerPage;
            const endIndex = Math.min(startIndex + itemsPerPage, totalItems);
            const pageAppointments = filteredAppointments.slice(startIndex, endIndex);

            // Update table count
            document.getElementById('tableCount').textContent = `(${totalItems} appointments)`;

            if (pageAppointments.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="7" style="text-align: center; padding: 2rem;">
                            <i class="fas fa-user-injured fa-2x mb-2" style="color: var(--text-light);"></i>
                            <p>No patient appointments match your filters</p>
                            <button class="action-btn btn-view" onclick="clearFilters()">
                                <i class="fas fa-times"></i> Clear Filters
                            </button>
                        </td>
                    </tr>
                `;
            } else {
                const rows = pageAppointments.map(appointment => {
                    // Determine status badge class
                    let statusClass = '';
                    let statusText = appointment.status || 'Pending';

                    switch (statusText) {
                        case 'Pending':
                            statusClass = 'status-pending';
                            break;
                        case 'Confirmed':
                            statusClass = 'status-confirmed';
                            break;
                        case 'Completed':
                            statusClass = 'status-completed';
                            break;
                        case 'Cancelled':
                            statusClass = 'status-cancelled';
                            break;
                        default:
                            statusClass = 'status-pending';
                    }

                    // Get department class
                    const department = appointment.department || 'General';
                    const departmentClass = getDepartmentClass(department);

                    // Get urgency class
                    const urgency = appointment.urgency || 'Normal';
                    const urgencyClass = getUrgencyClass(urgency);

                    // Get time class
                    const time = appointment.appointmentTime || '9:00 AM';
                    const timeClass = getTimeClass(time);

                    return `
                        <tr class="table-row">
                            <td class="patient-id">${appointment.patientId || 'PID-N/A'}</td>
                            <td>
                                <div class="patient-info">
                                    <div class="patient-avatar" style="background: ${appointment.avatarColor}">
                                        ${appointment.initials || 'P'}
                                    </div>
                                    <div class="patient-details">
                                        <div class="patient-name">${appointment.fullName || 'Anonymous'}</div>
                                        <div class="patient-age">${appointment.age || 'N/A'} yrs ‚Ä¢ ${appointment.gender || 'N/A'}</div>
                                    </div>
                                </div>
                            </td>
                            <td>
                                <span class="department-badge ${departmentClass}">
                                    ${department}
                                </span>
                            </td>
                            <td>
                                <div>${formatDate(appointment.appointmentDate)}</div>
                                <div>
                                    <span class="time-badge ${timeClass}">
                                        ${formatTime(time)}
                                    </span>
                                </div>
                            </td>
                            <td>
                                <span class="urgency-badge ${urgencyClass}">
                                    ${urgency}
                                </span>
                            </td>
                            <td>
                                <span class="status-badge ${statusClass}">${statusText}</span>
                            </td>
                            <td>
                                <div class="action-buttons">
                                    <button class="action-btn btn-view" onclick="viewAppointment('${appointment._id}')">
                                        <i class="fas fa-eye"></i> View
                                    </button>
                                    <button class="action-btn btn-update" onclick="updateAppointment('${appointment._id}')">
                                        <i class="fas fa-edit"></i> Update
                                    </button>
                                    ${statusText === 'Confirmed' ? `
                                    <button class="action-btn btn-prescribe" onclick="prescribeForAppointment('${appointment._id}')">
                                        <i class="fas fa-prescription"></i> Rx
                                    </button>
                                    ` : ''}
                                </div>
                            </td>
                        </tr>
                    `;
                }).join('');

                tbody.innerHTML = rows;
            }

            // Update pagination info
            document.getElementById('pageInfo').textContent = `Page ${currentPage} of ${totalPages}`;

            // Update pagination buttons
            document.getElementById('prevBtn').disabled = currentPage === 1;
            document.getElementById('nextBtn').disabled = currentPage === totalPages || totalPages === 0;
        }

        // Function to change page
        function changePage(direction) {
            const totalPages = Math.ceil(filteredAppointments.length / itemsPerPage);
            const newPage = currentPage + direction;

            if (newPage >= 1 && newPage <= totalPages) {
                currentPage = newPage;
                renderAppointmentsTable();
            }
        }

        // View Appointment Function
        async function viewAppointment(appointmentId) {
            try {
                console.log(`üëÅÔ∏è Viewing patient appointment: ${appointmentId}`);

                // Find the appointment
                const appointment = allAppointments.find(a => a._id === appointmentId) || getMockHospitalAppointments().find(a => a._id === appointmentId);

                if (!appointment) {
                    showToast('Appointment not found', 'error');
                    return;
                }

                currentAppointmentId = appointmentId;

                // Format dates
                const createdAt = new Date(appointment.createdAt).toLocaleDateString('en-US', {
                    year: 'numeric',
                    month: 'long',
                    day: 'numeric',
                    hour: '2-digit',
                    minute: '2-digit'
                });

                const updatedAt = appointment.updatedAt ?
                    new Date(appointment.updatedAt).toLocaleDateString('en-US', {
                        year: 'numeric',
                        month: 'long',
                        day: 'numeric',
                        hour: '2-digit',
                        minute: '2-digit'
                    }) : 'Not updated yet';

                const detailsHtml = `
                    <div class="detail-section">
                        <h4><i class="fas fa-info-circle"></i> Appointment Information</h4>
                        <div class="detail-grid">
                            <div class="detail-item">
                                <span class="detail-label">Appointment ID</span>
                                <div class="detail-value">${appointment.appointmentId || 'APPT-N/A'}</div>
                            </div>
                            <div class="detail-item">
                                <span class="detail-label">Patient ID</span>
                                <div class="detail-value">${appointment.patientId || 'PID-N/A'}</div>
                            </div>
                            <div class="detail-item">
                                <span class="detail-label">Status</span>
                                <div class="detail-value">
                                    <span class="status-badge ${appointment.status ? 'status-' + appointment.status.toLowerCase() : 'status-pending'}">
                                        ${appointment.status || 'Pending'}
                                    </span>
                                </div>
                            </div>
                            <div class="detail-item">
                                <span class="detail-label">Urgency</span>
                                <div class="detail-value">
                                    <span class="urgency-badge ${getUrgencyClass(appointment.urgency || 'Normal')}">
                                        ${appointment.urgency || 'Normal'}
                                    </span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="detail-section">
                        <h4><i class="fas fa-user-injured"></i> Patient Information</h4>
                        <div class="detail-grid">
                            <div class="detail-item">
                                <span class="detail-label">Full Name</span>
                                <div class="detail-value">${appointment.fullName || 'Not provided'}</div>
                            </div>
                            <div class="detail-item">
                                <span class="detail-label">Age & Gender</span>
                                <div class="detail-value">${appointment.age || 'N/A'} years, ${appointment.gender || 'Not provided'}</div>
                            </div>
                            <div class="detail-item">
                                <span class="detail-label">Contact Number</span>
                                <div class="detail-value">${appointment.mobile || 'Not provided'}</div>
                            </div>
                            <div class="detail-item">
                                <span class="detail-label">Email Address</span>
                                <div class="detail-value">${appointment.email || 'Not provided'}</div>
                            </div>
                            <div class="detail-item" style="grid-column: 1 / -1;">
                                <span class="detail-label">Medical History</span>
                                <div class="detail-value">${appointment.medicalHistory || 'None reported'}</div>
                            </div>
                            <div class="detail-item" style="grid-column: 1 / -1;">
                                <span class="detail-label">Current Symptoms</span>
                                <div class="detail-value">${appointment.symptoms || 'Not specified'}</div>
                            </div>
                        </div>
                    </div>

                    <div class="detail-section">
                        <h4><i class="fas fa-hospital"></i> Medical Details</h4>
                        <div class="detail-grid">
                            <div class="detail-item">
                                <span class="detail-label">Department</span>
                                <div class="detail-value">
                                    <span class="department-badge ${getDepartmentClass(appointment.department || 'General')}">
                                        ${appointment.department || 'General Medicine'}
                                    </span>
                                </div>
                            </div>
                            <div class="detail-item">
                                <span class="detail-label">Assigned Doctor</span>
                                <div class="detail-value">${appointment.doctorAssigned || 'Not assigned'}</div>
                            </div>
                            <div class="detail-item">
                                <span class="detail-label">Appointment Date</span>
                                <div class="detail-value">${formatDate(appointment.appointmentDate)}</div>
                            </div>
                            <div class="detail-item">
                                <span class="detail-label">Appointment Time</span>
                                <div class="detail-value">
                                    <span class="time-badge ${getTimeClass(appointment.appointmentTime)}">
                                        ${formatTime(appointment.appointmentTime)}
                                    </span>
                                </div>
                            </div>
                            <div class="detail-item">
                                <span class="detail-label">Insurance Provider</span>
                                <div class="detail-value">${appointment.insuranceProvider || 'Not insured'}</div>
                            </div>
                        </div>
                    </div>

                    <div class="detail-section">
                        <h4><i class="fas fa-sticky-note"></i> Additional Information</h4>
                        <div class="detail-grid">
                            <div class="detail-item" style="grid-column: 1 / -1;">
                                <span class="detail-label">Address</span>
                                <div class="detail-value">${appointment.address || 'Not provided'}</div>
                            </div>
                            <div class="detail-item" style="grid-column: 1 / -1;">
                                <span class="detail-label">Doctor's Notes</span>
                                <div class="detail-value">${appointment.notes || 'No notes available'}</div>
                            </div>
                            <div class="detail-item">
                                <span class="detail-label">Submitted On</span>
                                <div class="detail-value">${createdAt}</div>
                            </div>
                            <div class="detail-item">
                                <span class="detail-label">Last Updated</span>
                                <div class="detail-value">${updatedAt}</div>
                            </div>
                        </div>
                    </div>
                `;

                document.getElementById('appointmentDetails').innerHTML = detailsHtml;
                document.getElementById('viewModal').classList.add('active');

            } catch (error) {
                console.error('‚ùå Error viewing appointment:', error);
                showToast('Error loading appointment details', 'error');
            }
        }

        // Update Appointment Function
        async function updateAppointment(appointmentId) {
            try {
                console.log(`‚úèÔ∏è Updating patient appointment: ${appointmentId}`);

                // Find the appointment
                const appointment = allAppointments.find(a => a._id === appointmentId) || getMockHospitalAppointments().find(a => a._id === appointmentId);

                if (!appointment) {
                    showToast('Appointment not found', 'error');
                    return;
                }

                currentAppointmentId = appointmentId;

                const formHtml = `
                    <div class="form-group">
                        <label>Patient Information</label>
                        <div class="detail-value" style="padding: 0.75rem; background: var(--light-hospital); border-radius: 8px;">
                            <strong>${appointment.fullName || 'Anonymous'}</strong> ‚Ä¢ ${appointment.age || 'N/A'} yrs ‚Ä¢ ${appointment.department || 'General'}
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="statusSelect">Update Status *</label>
                        <select class="form-select" id="statusSelect" required>
                            <option value="Pending" ${appointment.status === 'Pending' ? 'selected' : ''}>Pending</option>
                            <option value="Confirmed" ${appointment.status === 'Confirmed' ? 'selected' : ''}>Confirmed</option>
                            <option value="Completed" ${appointment.status === 'Completed' ? 'selected' : ''}>Completed</option>
                            <option value="Cancelled" ${appointment.status === 'Cancelled' ? 'selected' : ''}>Cancelled</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="urgencySelect">Urgency Level</label>
                        <select class="form-select" id="urgencySelect">
                            <option value="Normal" ${appointment.urgency === 'Normal' ? 'selected' : ''}>Normal</option>
                            <option value="Urgent" ${appointment.urgency === 'Urgent' ? 'selected' : ''}>Urgent</option>
                            <option value="Emergency" ${appointment.urgency === 'Emergency' ? 'selected' : ''}>Emergency</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="doctorSelect">Assign Doctor</label>
                        <select class="form-select" id="doctorSelect">
                            <option value="">Select Doctor</option>
                            <option value="Dr. Sharma" ${appointment.doctorAssigned === 'Dr. Sharma' ? 'selected' : ''}>Dr. Sharma (Cardiology)</option>
                            <option value="Dr. Patel" ${appointment.doctorAssigned === 'Dr. Patel' ? 'selected' : ''}>Dr. Patel (Neurology)</option>
                            <option value="Dr. Singh" ${appointment.doctorAssigned === 'Dr. Singh' ? 'selected' : ''}>Dr. Singh (Orthopedics)</option>
                            <option value="Dr. Verma" ${appointment.doctorAssigned === 'Dr. Verma' ? 'selected' : ''}>Dr. Verma (Pediatrics)</option>
                            <option value="Dr. Kumar" ${appointment.doctorAssigned === 'Dr. Kumar' ? 'selected' : ''}>Dr. Kumar (General Medicine)</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="roomSelect">Assign Room</label>
                        <select class="form-select" id="roomSelect">
                            <option value="">Select Room</option>
                            <option value="Room 101">Room 101 (Cardiology)</option>
                            <option value="Room 102">Room 102 (Neurology)</option>
                            <option value="Room 103">Room 103 (Orthopedics)</option>
                            <option value="Room 104">Room 104 (Pediatrics)</option>
                            <option value="Room 105">Room 105 (General Medicine)</option>
                            <option value="ICU 1">ICU 1 (Emergency)</option>
                            <option value="ICU 2">ICU 2 (Emergency)</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="newDate">Reschedule Date (if needed)</label>
                        <input type="date" class="form-control" id="newDate" value="${appointment.appointmentDate || ''}">
                    </div>

                    <div class="form-group">
                        <label for="newTime">Reschedule Time (if needed)</label>
                        <select class="form-select" id="newTime">
                            <option value="">Select time</option>
                            <option value="9:00 AM" ${appointment.appointmentTime === '9:00 AM' ? 'selected' : ''}>9:00 AM</option>
                            <option value="10:30 AM" ${appointment.appointmentTime === '10:30 AM' ? 'selected' : ''}>10:30 AM</option>
                            <option value="11:45 AM" ${appointment.appointmentTime === '11:45 AM' ? 'selected' : ''}>11:45 AM</option>
                            <option value="2:00 PM" ${appointment.appointmentTime === '2:00 PM' ? 'selected' : ''}>2:00 PM</option>
                            <option value="3:30 PM" ${appointment.appointmentTime === '3:30 PM' ? 'selected' : ''}>3:30 PM</option>
                            <option value="4:45 PM" ${appointment.appointmentTime === '4:45 PM' ? 'selected' : ''}>4:45 PM</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="medicalNotes">Medical Notes / Diagnosis</label>
                        <textarea class="form-textarea" id="medicalNotes" placeholder="Enter diagnosis, observations, and treatment plan...">${appointment.notes || ''}</textarea>
                    </div>

                    <div class="form-group">
                        <label for="followupDate">Follow-up Date (if required)</label>
                        <input type="date" class="form-control" id="followupDate">
                    </div>

                    <div class="form-group">
                        <label for="prescription">Prescription Details</label>
                        <textarea class="form-textarea" id="prescription" placeholder="Enter prescription details..."></textarea>
                    </div>
                `;

                document.getElementById('updateForm').innerHTML = formHtml;
                document.getElementById('updateModal').classList.add('active');

            } catch (error) {
                console.error('‚ùå Error loading update form:', error);
                showToast('Error loading appointment details', 'error');
            }
        }

        // Save Update Function
        async function saveUpdate() {
            try {
                const newStatus = document.getElementById("statusSelect").value;

                const res = await fetch(`/hospital/appointments/${currentAppointmentId}`, {
                    method: "PUT",
                    headers: {
                        "Content-Type": "application/json"
                    },
                    body: JSON.stringify({
                        status: newStatus
                    })
                });

                const data = await res.json();

                if (!data.success) {
                    throw new Error("Update failed");
                }

                // ‚úÖ update UI locally
                const index = allAppointments.findIndex(a => a._id === currentAppointmentId);
                if (index !== -1) {
                    allAppointments[index].status = newStatus;
                }

                renderAppointmentsTable();
                closeModal();

                showToast("Status updated successfully", "success");
            }
            catch (error) {
                console.error(error);
                showToast("Failed to update status", "error");
            }
        }



        // Prescribe Medication Function
        function prescribeForAppointment(appointmentId) {
            const appointment = allAppointments.find(a => a._id === appointmentId);
            if (appointment) {
                showToast(`Opening prescription form for ${appointment.fullName}`, 'info');
                // In real app, this would open a prescription form
            }
        }

        // Quick Actions Functions
        function addNewAppointment() {
            showToast("Opening new appointment form", "info");
            // In real app, this would open a form to add new appointment
        }

        function viewTodaySchedule() {
            // Filter for today's appointments
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('dateFilter').value = 'today';
            filterAppointments();
            showToast("Showing today's appointments", "info");
        }

        function viewEmergencyQueue() {
            // Filter for emergency appointments
            document.getElementById('urgencyFilter').value = 'Emergency';
            filterAppointments();
            showToast("Showing emergency cases", "warning");
        }

        function generateReport() {
            showToast("Generating appointment report...", "info");
            // In real app, this would generate a PDF report
        }

        // Emergency Alert Functions
        function showEmergencyAlert() {
            const emergencyAlert = document.getElementById('emergencyAlert');
            emergencyAlert.style.display = 'flex';

            // Hide after 10 seconds
            setTimeout(() => {
                emergencyAlert.style.display = 'none';
            }, 10000);
        }

        function viewEmergencyCase() {
            // Find an emergency appointment
            const emergencyAppointment = allAppointments.find(a => a.urgency === 'Emergency');
            if (emergencyAppointment) {
                viewAppointment(emergencyAppointment._id);
                document.getElementById('emergencyAlert').style.display = 'none';
            }
        }

        // Close Modal Function
        function closeModal() {
            document.getElementById('viewModal').classList.remove('active');
            document.getElementById('updateModal').classList.remove('active');
            currentAppointmentId = '';
        }

        // Show Toast Notification
        function showToast(message, type = 'success') {
            const toast = document.getElementById('toast');
            const toastTitle = document.getElementById('toastTitle');
            const toastMessage = document.getElementById('toastMessage');
            const toastIcon = toast.querySelector('i');

            // Set icon and title based on type
            if (type === 'error') {
                toast.style.borderLeftColor = 'var(--danger-hospital)';
                toastIcon.className = 'fas fa-exclamation-circle';
                toastIcon.style.color = 'var(--danger-hospital)';
                toastTitle.textContent = 'Error!';
            } else if (type === 'warning') {
                toast.style.borderLeftColor = 'var(--warning-hospital)';
                toastIcon.className = 'fas fa-exclamation-triangle';
                toastIcon.style.color = 'var(--warning-hospital)';
                toastTitle.textContent = 'Warning!';
            } else if (type === 'info') {
                toast.style.borderLeftColor = 'var(--info-hospital)';
                toastIcon.className = 'fas fa-info-circle';
                toastIcon.style.color = 'var(--info-hospital)';
                toastTitle.textContent = 'Info!';
            } else {
                toast.style.borderLeftColor = 'var(--success-hospital)';
                toastIcon.className = 'fas fa-check-circle';
                toastIcon.style.color = 'var(--success-hospital)';
                toastTitle.textContent = 'Success!';
            }

            toastMessage.textContent = message;
            toast.classList.add('show');

            setTimeout(() => {
                toast.classList.remove('show');
            }, 3000);
        }

        // Close modal when clicking outside
        document.addEventListener('click', (e) => {
            if (e.target.classList.contains('modal-overlay')) {
                closeModal();
            }
        });

        // Close modal with Escape key
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') {
                closeModal();
            }
        });
    </script>
</body>

</html>